{% extends 'global.html' %}

{% load komoo_map_tags %}
{% load crispy_forms_tags %}
{% load vote_tags %}
{% load comment_tags %}
{% load markitup_tags %}
{% load komoo_tags %}
{% load i18n %}

{% block title %}{{ resource.name }} at {{ resource.community.name }}{% endblock %}

{% block menu %} {% menu community "resource" %} {% endblock %}

{% block content %}
  <div id="main-content" class="resource-main">
    <div class="resource main-column">
      <div class="resource-header">
        <h2>{{ resource.name }}</h2>
        <div class="resource-votes">
          {% vote resource %}
          <div class="resource-edit-btn">
            {% if community %}
            <a href="/{{ community.slug }}/resource/edit?id={{ resource.id }}" class="btn">
            {% else %}
            <a href="/resource/edit?id={{ resource.id }}" class="btn">
            {% endif %}
              <i class="icon-pencil"></i>
            </a>
          </div>
        </div>
        <span>
          {% trans 'created by' %} <a href="#">{% firstof resource.creator.get_full_name resource.creator.username 'someone' %}</a>
          {% trans 'in' %} {{ resource.creation_date|date:"d/m/Y" }}
        </span>
        <span class="resource-type">{% trans 'type:' %} &nbsp;<strong>{{ resource.kind }}</strong></span>
      </div>

      <div class="resource-body">
        <div class="mark-down">{{ resource.description|render_markup }}</div>
      </div>

      <div class="resource-footer">
        <!-- Photos here -->
        {% if photos.object_list %}
        <div class="resource-photos">
          <h3>{% trans 'Photos:' %}</h3>
          {% for photo in photos.object_list %}
            <a href="{{ photo.file.url }}"><img src="{{ photo.file.url }}"></a>
          {% endfor %}

          {% pagination photos %}

        </div>
        {% endif %}

      </div>
    </div>
    <div class="right-bar">
      <div id="map-preview">{% komoo_map geojson %}</div>
      <a href="{% url show_on_map %}?type=Resource&id={{resource.id}}">{% trans 'see on map' %}</a>
      <div class="block">
        <h3>{% trans 'Similar Resources:' %}</h3>
        {% if similar %}
          {% for s in similar %}
            <p><a href="/resource/{{ s.id }}/">{{s.name}}</a> - {% firstof s.community.name '' %}</p>
          {% endfor %}
        {% else %}
          <p>{% trans 'There is no similar resources...' %}</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="resource-extras">
    {% taglist resource %}
    {% track_buttons %}
    {% comments resource %}
  </div>


{% endblock %}

{% block page_scripts %}
  {% vote_staticfiles %}
  {% comments_staticfiles %}
  <script type="text/javascript">
      $('.resource-footer img').each(function(idx, obj){
        if(obj.offsetHeight > obj.offsetWidth){
          $(obj).css('height', '160px').css('width', 'auto')
                .css('padding-left', Math.abs(obj.offsetWidth - 200) /2 )
                .css('padding-right', Math.abs(obj.offsetWidth - 200) /2 );
        } else {
          $(obj).css('height', 'auto').css('width', '200px')
              .css('padding-bottom', Math.abs(obj.offsetHeight - 200) /2)
              .css('padding-top', Math.abs(obj.offsetHeight - 200) /2);
        }
      });
  </script>
{% endblock %}

{% block css %}
  <link rel="stylesheet" type="text/css" href="/static/css/resource.css" >
{% endblock %}
