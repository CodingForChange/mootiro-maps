{% extends 'global.html' %}

{% load komoo_map_tags %}
{% load crispy_forms_tags %}
{% load vote_tags %}
{% load comment_tags %}
{% load markitup_tags %}
{% load komoo_tags %}
{% load i18n %}

{% block title %}{{ resource.name }} at {{ resource.community.name }}{% endblock %}

{% block menu %} {% menu community "resource" %} {% endblock %}

{% block content %}
  {#% komoo_map geojson 'type=view' 'width=100%' 'height=100%' 'zoom=13' 'panel=False' 'ajax=True' 'lazy=True' %#}
<div id="main-content" class="inline-block">
    <div class="main-column">

        <div class="view-header">
            <h2>{{ resource.name }}</h2>
            <div class="view-votes">
                {% vote resource %}
                <div class="view-edit-btn">
                    {% if community %}
                    <a href="/{{ community.slug }}/resource/edit?id={{ resource.id }}" class="btn login-required">
                    {% else %}
                    <a href="/resource/edit?id={{ resource.id }}" class="btn login-required">
                    {% endif %}
                        <i class="icon-pencil"></i>
                    </a>
                </div>
            </div>
            <span>
                {% trans 'created by' %} <a href="#">{% firstof resource.creator.get_full_name resource.creator.username 'someone' %}</a>
                {% trans 'in' %} {{ resource.creation_date|date:"d/m/Y" }}
            </span>
            <span class="resource-type">{% trans 'type:' %} &nbsp;<strong>{{ resource.kind }}</strong></span>
        </div>

        <div class="view-body">
            <div class="mark-down">{{ resource.description|render_markup }}</div>
        </div>

        <div class="view-footer">
            <!-- Photos here -->
            {% if photos.object_list %}
            <div class="resource-photos">
                <h3>{% trans 'Photos:' %}</h3>
                {% for photo in photos.object_list %}
                    <a href="{{ photo.file.url }}">
                        <img src="{{ photo.file.url }}">
                    </a>
                {% endfor %}

            </div>
            {% pagination photos %}
            {% endif %}
        </div>
    </div>
    <div class="right-bar">
        <div id="map-preview">{#% komoo_map geojson 'type=preview' %#}</div>
        <a class="see-on-map" href="#">{% trans 'see on map' %}</a>

        {% with similar_resources=resource.tags.similar_objects %}
            {% if similar_resources %}
            <div class="block">
                <h3>Related resources</h3>
                <ul>
                    {% for r in similar_resources|slice:'5' %}
                    <li>
                        <a href="{{ r.view_url }}"> {{ r.name }} </a>
                        {% if r.community %}
                          {% trans 'at' %} {{ r.community.name }}
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        {% endwith %}

        <div class="centralizer apart">
          <a class="button" href="{{ resource.new_investment_url }}">Add investment</a>
        </div>

    </div>

    <div class="view-extras">
            {% taglist resource %}
            {% track_buttons %}
            {% comments resource %}
    </div>

</div>




{% endblock %}

{% block page_scripts %}
    {% vote_staticfiles %}
    {% comments_staticfiles %}
    <script type="text/javascript">
            $('.view-footer img').each(function(idx, obj){
                if(obj.offsetHeight > obj.offsetWidth){
                    $(obj).css('height', '160px').css('width', 'auto')
                                .css('padding-left', Math.abs(obj.offsetWidth - 200) /2 )
                                .css('padding-right', Math.abs(obj.offsetWidth - 200) /2 );
                } else {
                    $(obj).css('height', 'auto').css('width', '200px')
                            .css('padding-bottom', Math.abs(obj.offsetHeight - 200) /2)
                            .css('padding-top', Math.abs(obj.offsetHeight - 200) /2);
                }
            });
    </script>
{% endblock %}
