if(typeof jQuery.fn.autocompletehtml!="function"){(function(e){e.fn.autocompletehtml=function(){var t=e(this),n=!0;return this.data("autocomplete")._renderItem=function(i,s){return n&&(i.css("max-width")=="none"&&i.css("max-width",t.outerWidth()),n=!1),e("<li></li>").data("item.autocomplete",s).append("<a>"+s.match+"</a>").appendTo(i)},this},e.fn.autocompleteselect=function(t){return this.each(function(){function o(e,t){return r.val()&&a(),r.val(t.item.pk),i.val(""),u(t.item.repr),s.trigger("added"),!1}function u(t,r){killer_id="kill_"+r+n,killButton='<span class="ui-icon ui-icon-trash" id="'+killer_id+'">X</span> ',t?(s.empty(),s.append("<div>"+killButton+t+"</div>")):e("#"+n+"_on_deck > div").prepend(killButton),e("#"+killer_id).click(function(){a(),s.trigger("killed")})}function a(){r.val(""),s.children().fadeOut(1).remove()}var n=this.id,r=e(this),i=e("#"+n+"_text"),s=e("#"+n+"_on_deck");t.select=o,i.autocomplete(t),i.autocompletehtml(),t.initial&&(its=t.initial,u(its[0],its[1])),r.bind("didAddPopup",function(e,t,n){ui={item:{pk:t,repr:n}},o(null,ui)})})},e.fn.autocompleteselectmultiple=function(t){return this.each(function(){function o(e,t){return pk=t.item.pk,prev=r.val(),prev.indexOf("|"+pk+"|")==-1&&(r.val((prev?prev:"|")+pk+"|"),u(t.item.repr,pk),i.val(""),s.trigger("added")),!1}function u(t,r){killer_id="kill_"+r+n,killButton='<span class="ui-icon ui-icon-trash" id="'+killer_id+'">X</span> ',s.append('<div id="'+n+"_on_deck_"+r+'">'+killButton+t+" </div>"),e("#"+killer_id).click(function(){a(r),s.trigger("killed")})}function a(t){r.val(r.val().replace("|"+t+"|","|")),e("#"+n+"_on_deck_"+t).fadeOut().remove()}var n=this.id,r=e(this),i=e("#"+n+"_text"),s=e("#"+n+"_on_deck");t.select=o,i.autocomplete(t),i.autocompletehtml(),t.initial&&e.each(t.initial,function(e,t){u(t[0],t[1])}),r.bind("didAddPopup",function(e,t,n){ui={item:{pk:t,repr:n}},o(null,ui)})})}})(jQuery);var addAutoComplete=function(e,t){var n=0,r=e;if(r.indexOf("__prefix__")!=-1){while(jQuery("#"+r).length)r=e.replace(/__prefix__/,n++);r=e.replace(/__prefix__/,n-2);if(jQuery("#"+r+", #"+r+"_text").hasClass("ui-autocomplete-input"))return}t(r)},didAddPopup=function(e,t,n){var r=windowname_to_id(e.name);jQuery("#"+r).trigger("didAddPopup",[html_unescape(t),html_unescape(n)]),e.close()}}