{% load i18n %}
{% load komoo_tags %}

<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>{% block title %}Mootiro Maps{% endblock %}</title>
    <link rel="image_src" href="{{STATIC_URL}}img/logo.png" />
    {{ form.media.css }}
    <link rel="shortcut icon" HREF="{{STATIC_URL}}/img/favicon.png" />
    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}lib/jquery-ui-1.8.16/jquery-ui-1.8.16.css" />
    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/styles.css" />
    <script type="text/javascript" src="{% url javascript_catalog %}"></script>
    <script type="text/javascript" src="{{STATIC_URL}}lib/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}lib/jquery-ui-1.8.16/jquery-ui-1.8.16.min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}lib/django-js-utils/dutils.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}lib/django-js-utils/dutils.conf.urls.js"></script>
    <!-- Our utilities lib -->
    <script type="text/javascript">var isAuthenticated = {{ user.is_authenticated|lower }};</script>
    <script type="text/javascript" src="{{STATIC_URL}}lib/shortcut.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/komoo_utils.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/ajaxforms.js"></script>

    {{ form.media.js }}
    {% block css %}{% endblock %}
  </head>
  <body class="{% if community %}community{% endif %}">

    <!-- Facebook stuff -->
    <div id="fb-root"></div>
    <script>
      (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId={{ FACEBOOK_APP_ID }}";
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
    </script>


    <!-- Mootiro_bar goes here -->
    <div id="root">
      <div id="top">
        <div id="logo">
          <a href="{% url root %}"><img src='{{STATIC_URL}}img/logo.png' alt='Mootiro Maps'/></a>
        </div>
        <div id="navigation">

          <form id="search" action=".">
            <input type="text" id="search-bar"/>
            <input type="submit" id="search-button" class="button" value="{% trans 'Search' %}"/>
          </form>
          {% block menu %}
            {% with obj=community selected_area="" %}
              {% menu obj selected_area %}
            {% endwith %}
          {% endblock %}

        </div>

      {% with c=community %} {% community_tabs c %} {% endwith %}

      </div>
      <div id="content">
        {% block content %}{% endblock %}
      </div>
      <div id="footer">
        {% block footer %}
          {% include "main/footer.html" %}
        {% endblock %}
      </div>
      {% if not user.is_authenticated %}
        {% include "main/login_box.html" %}
      {% endif %}
      {% include "main/error_box.html" %}
    </div>
    {% block page_scripts %}{% endblock %}

    <script type="text/javascript">
      $(function(){
        // fixes annoying behaviour on leaving a community context
        var areas = ['organization', 'needs', 'resource', 'investments'],
            path_split = location.pathname.split('/');

        if ( ($.inArray(path_split[1], areas) == -1) &&
             ($.inArray(path_split[2], areas) > -1) ){
          $('#tabs .tab a').attr('href',
              '/' + path_split.slice(2).join('/') );
        }

      });
    </script>

    <!-- Google Analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-31165229-1']);
      _gaq.push(['_setDomainName', 'mootiro.org']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
