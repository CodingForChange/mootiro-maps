{% extends 'global.html' %}

{% load i18n %}
{% load komoo_tags %}
{% load komoo_map_tags %}
{% load markitup_tags %}
{% load comment_tags %}

{% block content %}

<div class="profile-container">

    <!-- profile left pane -->
    <div class="profile-left-pane">

        <!-- profile header (name and edit button) -->
        <div class="profile-lp-header">
            <span class="profile-lp-header-username">{{ user_profile.get_name }}</span>
            {% if user.id == user_profile.id %}
            <a href="{% url profile_update %}" class="btn profile-lp-header-edit-btn">
                <i class="icon-pencil"></i>
            </a>
            {% endif %}
        </div>

        <!-- User photo -->
        <div class="profile-lp-photo">
            <img src="{{ user_profile.profile.files_set.0.file.url }}" alt="user photo" />
        </div>

        <!-- user contact info -->
        <div class="profile-lp-contact">
            <div class="profile-lp-contact-header">{% trans 'Public Contact' %}</div>
            {% if user_profile.profile.contact %}
                {{ user_profile.profile.contact|render_markup|safe }}
            {% else %}
                {% trans 'Information Not Provided!' %}
            {% endif %}
        </div>
        <div class="profile-lp-map-preview">
          <div id="map-canvas-main-preview" class="map-canvas">
            <div class="placeholder">
              {% if geojson %}
                {% trans 'Loading...' %}
              {% else %}
                {% trans 'Map position not available' %}
              {% endif %}
            </div>
          </div>
        </div>

        <!-- map info section -->
        <div class="profile-lp-map-actions">

        </div>

    </div> <!-- End of profile left pane -->


    <div class="profile-central-pane">

    </div>
    <div class="profile-footer">
        {% comments user_profile %}
    </div>
</div>


    <!-- Templates section -->

    <script type="text/template" id="contribution-template">
        <div class="inline-block contribution-image">
            <img src="<%= imageName() %>" alt="Image" />
        </div>
        <div class="inline-block contribution-content">
            <div class="contribution-header">
                <a href="<%= permalink %>" class="contribution-title"><%= name %></a>
                <div class="right">
                    <a href="#" class="preview-on-map-ajax <% if (!has_geojson) { %>disabled<% } %>" data-app-name="<%= app_name %>" data-model-name="<%= model_name %>" data-object-id="<%= id %>">
                        <i class="icon-see-on-map"></i>
                    </a>
                </div>
            </div>
            <div class="contribution-body">
                <%= actionDesc() %>
            </div>
        </div>
    </script>

    <script type="text/template" id="contributions-template">
        <div class="profile-cp-header"><span>{% trans 'last contributions' %}</span></div>
        <div class="profile-cp-contributions">

        </div>
    </script>
{% endblock %}

{% block css %}

{% endblock %}

{% block page_scripts %}


    <!-- Javascript section -->
    <script src="{{ STATIC_URL}}lib/underscore-min.js" type="text/javascript"></script>
    <script src="{{STATIC_URL}}lib/backbone-min.js" type="text/javascript"></script>

    <script type="text/javascript">
        if (typeof window.KomooNS == 'undefined' ) window.KomooNS = {};
        KomooNS.contributions = {{ contributions|jsonify|safe }};
    </script>

    <script src="{{ STATIC_URL }}js/profile.js" type="text/javascript"></script>
    {% komoo_map_tooltip %}
    {% comments_staticfiles %}

    {% if geojson %}
    <script type="text/javascript">
        var community_slug = '{{ community.slug }}';
        require(['map.jquery'], function () {
            $("#map-canvas-main-preview").komooMap({
                type: 'preview',
                mapType: google.maps.MapTypeId.ROADMAP,
                zoom: 16,
                geojson: {{ geojson|safe }},
                width: '317px',
                height: '200px'
            });
        });
    {% endif %}
    </script>
{% endblock %}

