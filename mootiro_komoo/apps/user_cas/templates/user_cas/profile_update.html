{% extends 'global.html' %}

{% load i18n %}
{% load komoo_tags %}
{% load crispy_forms_tags %}

{% block content %}

<div id="main-content" class="user-profile-edit-container">
    <div class="main-column">
        <!-- tab navigation -->
        <ul class="nav nav-tabs">
            <li><a href="#tab-pane-personal" data-toggle="tab">Personal Settings</a></li>
            <li class="active"><a href="#tab-pane-public" data-toggle="tab">Public Settings</a></li>
            <li><a href="#tab-pane-signatures" data-toggle="tab">Signatures</a></li>
        </ul>

        <!-- tab content section -->
        <div class="tab-content">

            <!-- Tab pane personal settings -->
            <div class="tab-pane" id="tab-pane-personal">
                 PERSONAL SETTINGS
            </div><!-- end of tab pane personal settings -->


            <!-- Tab pane public settings -->
            <div class="tab-pane active" id="tab-pane-public">
                <div class="form-profile-wrapper">
                    {% crispy form_profile form_profile.helper %}
                </div>
            </div>


            <!-- Tab pane signatures -->
            <div class="tab-pane div-profile-form" id="tab-pane-signatures">
                SIGNATURES
            </div> <!-- end of signatures tab pane -->

        </div><!-- end of tab content-->
    </div>
</div>

<script type="text/template" id="form-profile-message-box">
    <div class="alert alert-info form-profile-message-box" style="display: none;" data-alert="info">
        <a class="close">×</a>
        <div class="msg"><%= msg %></div>
    </div>
</script>
{% endblock %}

{% block css %}

{% endblock %}

{% block page_scripts %}
    {{ form_profile.media }}
    <script src="{{STATIC_URL}}lib/underscore-min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function(){
            $('#form-profile').ajaxform({
                clean: false,
                onSuccess: function(data){
                    //TODO: display box with success message
                    console.log(data);
                    if ($('#form-profile .form-profile-message-box').length){
                        $('#form-profile .form-profile-message-box').remove();
                    }
                    var msgTemplate = _.template($('#form-profile-message-box').html());
                    var renderedContent = msgTemplate({
                        msg: gettext('Your public settings have been saved successfully!')
                    });
                    $('#form-profile .form-actions').before(renderedContent);
                    $('#form-profile .alert').slideDown();
                    return false;
                }
            });
            $('#form-profile .close').live('click', function(){
                $(this).parent().slideUp();
            });

            $('#form-profile').komooFormHintBoxes({
                'contact': {
                    hint: 'Este Contanto ficará visível para outros usuários do MootiroMaps!',
                    top: '30%'
                }
            });

        });
    </script>
{% endblock %}
