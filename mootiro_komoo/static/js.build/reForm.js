(function(){var e,t,n,r,i,s,o,u,a,f,l;a='<form action="" method="post" id="<%= formId %>" >\n    <div>\n        <input type="submit" name="submit" value="<%=submit_label%>" />\n    </div>\n</form>',u='<div class="field-container <%=container_class%>" for="<%=name%>" >\n    <label><%=label%></label>\n    <div class="widget-container">\n    </div>\n</div>',f='<input type="<%=type%>" name="<%=name%>" value="<%=value%>" id="id_<%=name%>" <%=attrs%> />',l='<textarea name="<%=name%>" id="id_<%=name%>"><%=value%></textarea>',o='<label>\n  <input type="checkbox" name="<%=name%>" value="<%=choice_value%>" id="id_<%=name%>_<%=choice_num%>" class="checkbox" />\n  <%=choice_title%>\n</label>',s=Backbone.View.extend({initialize:function(){return _.bindAll(this),this._template=_.template(this.template),this.name=this.options.name},render:function(){return this.$el.html(this._template(this.options)),typeof this.behavior=="function"&&this.behavior(),this},set:function(e){return this.$el.find("input[name="+this.name+"]").val(e)},get:function(){return this.$el.find("input[name="+this.name+"]").val()}}),i=s.extend({template:f,initialize:function(){var e;return this.options.type="text",(e=this.options).attrs==null&&(e.attrs=""),s.prototype.initialize.apply(this,arguments)}}),n=s.extend({template:f,initialize:function(){return this.options.type="password",this.options.value="",this.options.attrs='autocomplete="off"',s.prototype.initialize.apply(this,arguments)}}),r=s.extend({template:l,set:function(e){return this.$el.find("textarea").val(e)},get:function(){return this.$el.find("textarea").val()}}),e=s.extend({template:o,render:function(){var e,t,n,r,i;this.$el.html(""),i=this.options.choices;for(t in i)n=i[t],e=_.extend(this.options,{choice_value:n.value,choice_title:n.title,choice_num:t+1}),r=this._template(e),this.$el.append(r);return this},set:function(e){return e?this.$el.find("input[value="+e+"]").attr("checked",!0):this.$el.find(":checked").attr("checked",!1)},get:function(){var e;return e=this.$el.find(":checked"),e.length?e.val():""}}),t=Backbone.View.extend({initialize:function(){var e;_.bindAll(this),this.formTemplate=_.template(a);if((e=this.options)!=null?e.model:void 0)this.model=this.options.model;return this.on("submit",this.save)},render:function(){var e,t,n,r,i,s,o,a,f,l,c,h,p,d=this;n=((c=this.options)!=null?c.formId:void 0)||"",s=((h=this.options)!=null?h.submit_label:void 0)||(i18n?i18n("send"):"send"),i=this.formTemplate({formId:n,submit_label:s}),this.$el.html(i),p=this.fields.slice(0).reverse();for(f=0,l=p.length;f<l;f++)t=p[f],e={name:t.name,input_id:"id_"+t.name,label:t.label||"",value:t.value||"",container_class:t.container_class||""},e=_.extend(e,t.args||{}),o=new t.widget(e),t.instance=o,a=_.template(u),r=$(a(e)),r.find(".widget-container").append(o.render().el),this.$el.find("form").prepend(r),this.model&&this.set(this.model.toJSON());return this.$el.find("form").submit(function(e){return e.preventDefault(),d.trigger("submit")}),this},disableSubmit:function(){return this.$el.find("input[type=submit]").attr("disabled","disabled")},enableSubmit:function(){return this.$el.find("input[type=submit]").removeAttr("disabled")},save:function(){var e=this;return this.model.set(this.get()),this.disableSubmit(),this.model.save({},{success:function(t,n){return e.cleanErrors(),e.enableSubmit(),n.redirect&&(window.location.pathname===n.redirect?window.location.reload():window.location=n.redirect),e.trigger("success",n)},error:function(t,n){return e.enableSubmit(),n=JSON.parse(n.responseText),e.cleanErrors(),e.errors(n.errors||{}),e.trigger("error",n)}})},errors:function(e){var t,n,r;this._errors==null&&(this._errors={});if(!e)return this._errors;this._errors=_.extend(this._errors,e);for(r in e)n=e[r],t=this.$el.find(".field-container[for="+r+"]"),t.find("#id_"+r).addClass("error"),t.find("label").addClass("error"),t.find("small.error").length||t.find(".widget-container").after("<small class='error'>"+n+"</smalll>")},cleanErrors:function(){return this.$el.find("small.error").remove(),this.$el.find(".error").removeClass("error")},get:function(e){var t,n,r,i,s;e==null&&(e="__all__");if(e==="__all__"){n={},s=this.fields;for(r=0,i=s.length;r<i;r++)t=s[r],n[t.name]=t.instance.get();return n}return t=_.find(this.fields,function(t){return t.name===e}),t.instance.get()},set:function(e){var t,n,r,i,s;e==null&&(e={}),s=[];for(n in e)r=e[n],t=_.find(this.fields,function(e){return e.name===n}),s.push(t!=null?(i=t.instance)!=null?typeof i.set=="function"?i.set(r):void 0:void 0:void 0);return s}}),window.ReForm={Form:t,Widget:s,commonWidgets:{TextWidget:i,PasswordWidget:n,TextAreaWidget:r,CheckboxWidget:e}},typeof define=="function"&&define.amd&&define([],function(){return window.ReForm})}).call(this);