(function(){var e=Object.prototype.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["require","jquery","backbone","page_manager","./views","./models"],function(e){var n,r,i,s,o,u,a;return n=e("jquery"),r=e("backbone"),u=e("page_manager"),a=e("./views"),o=function(t){var n,i;if(t==null){typeof console!="undefined"&&console!==null&&console.log("User id not specified");return}return n=e("./models").User,i=new n,i.id=t,i.on("request",function(e){return r.trigger("app::working",e)}),i.on("sync",function(e,t,n){return r.trigger("app::done",e)}),i.on("error",function(e,t){if(t.status!=null)return r.trigger("app::done",e)}),i},s=function(e){function i(e,t){this.userId=e,this.mode=t!=null?t:"view",this.id="user::profile::"+this.userId}return t(i,e),i.prototype.setMode=function(e){if(this.mode===e){e==="edit"&&r.trigger("user::profile",this.userId);return}return this.actionBar.setMode(e),this.mainContent.setMode(e),this.mode=e},i.prototype.render=function(){var e,t,r,i=this;return e=new n.Deferred,console.log("--->",this.id),((r=u.currentPage)!=null?r.id:void 0)===this.id?(u.currentPage.setMode(this.mode),e.resolve(),e.promise()):(t=o(this.userId),window.user=t,t.fetch().done(function(){var n;return n={model:t,mode:i.mode},i.actionBar=new a.ActionBar(n),i.sidebar=new a.Sidebar(n),i.mainContent=new a.Profile(n),u.open(i),e.resolve()}).fail(function(t){return e.reject(t)}),e.promise())},i}(u.Page),i=function(e){function n(e,t){t==null&&(t="edit"),n.__super__.constructor.call(this,e,t)}return t(n,e),n}(s),{getUser:o,Profile:s,Edit:i}})}).call(this);