(function(){var e=Object.prototype.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["require","jquery","underscore","backbone","reForm","main/views","./forms","text!templates/user/_user_info.html","text!templates/user/_profile.html","text!templates/user/_sidebar.html","text!templates/user/_update_item.html","text!templates/user/_updates_block.html","widgets/list"],function(e){var n,r,i,s,o,u,a,f,l,c,h;return n=e("jquery"),h=e("underscore"),i=e("backbone"),o=e("reForm"),r=e("main/views").ActionBar,c=e("./forms").UserInfo,l=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.initialize=function(){return h.bindAll(this),this.template=h.template(e("text!templates/user/_user_info.html")),this.listenTo(this.model,"change",this.render),this.render()},r.prototype.render=function(){return this.$el.html(this.template({user:this.model.toJSON()}))},r}(i.View),s=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.initialize=function(){var t;return window.model=this.model,h.bindAll(this),this.template=h.template(e("text!templates/user/_profile.html")),this.userInfoView=new l({model:this.model}),this.userInfoForm=new c({model:this.model,formId:"user-info",submit_label:i18n("Save")}),this.listenTo(this.userInfoForm,"submit",this.onSubmit),this.userInfo={view:this.userInfoView,edit:this.userInfoForm},this.updatesView=new f({collection:this.model.getUpdates()}),this.subViews=[this.userInfoView,this.updatesView,this.userInfoForm],this.setMode((t=this.options.mode)!=null?t:"view")},r.prototype.render=function(){var e,t,n,r;r=this.subViews;for(t=0,n=r.length;t<n;t++)e=r[t],e.$el.detach();return this.$el.html(this.template({user:this.model.toJSON(),mode:this.mode})),this.$("#user-info-container").append(this.userInfo[this.mode].$el),this.$("#user-updates-container").append(this.updatesView.$el),this},r.prototype.setMode=function(e){return this.mode=e,this.model.hasPermission(this.mode)||(typeof console!="undefined"&&console!==null&&console.log("Mode '"+this.mode+"' not allowed, changing to 'view'."),this.mode="view"),this.userInfo[this.mode].render(),this.render()},r.prototype.onSubmit=function(){return i.trigger("user::profile",this.model.id)},r}(i.View),u=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.initialize=function(){return h.bindAll(this),this.template=h.template(e("text!templates/user/_sidebar.html")),this.render()},r.prototype.render=function(){return this.$el.html(this.template({user:this.model.toJSON()})),this},r}(i.View),a=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.tagName="li",r.prototype.events={"click .see-on-map":"seeOnMap"},r.prototype.initialize=function(){return h.bindAll(this),this.template=h.template(e("text!templates/user/_update_item.html")),this.listenTo(this.model,"change",this.render),this.render()},r.prototype.render=function(){var e,t;return this.$el.removeClass().addClass([(e=this.model.get("type"))!=null?e.toLowerCase():void 0,(t=this.model.get("action"))!=null?t.toLowerCase():void 0]),this.$el.html(this.template({update:this.model.toJSON()})),this},r.prototype.seeOnMap=function(e){return e!=null&&typeof e.preventDefault=="function"&&e.preventDefault(),i.trigger("map::see-on-map",this.model),this},r}(i.View),f=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.events={"click a.previous":"previousPage","click a.next":"nextPage","keypress .current-page":"goTo"},r.prototype.initialize=function(){var t;return h.bindAll(this),this.template=h.template(e("text!templates/user/_updates_block.html")),t=e("widgets/list"),this.listView=new t({collection:this.collection,className:"updates list",ItemView:a}),this.subViews=[this.listView],this.listenTo(this.collection,"reset",this.update),this.render()},r.prototype.render=function(){return this.listView.$el.detach(),this.$el.html(this.template(this.collection)),this.$(".list-container").prepend(this.listView.$el),this},r.prototype.update=function(){return this.$(".current-page").val(this.collection.currentPage+1),this.$(".total-pages").text(this.collection.totalPages),this.collection.currentPage===0?this.$(".previous").addClass("disabled"):this.$(".previous").removeClass("disabled"),this.collection.currentPage===this.collection.totalPages-1?this.$(".next").addClass("disabled"):this.$(".next").removeClass("disabled")},r.prototype.previousPage=function(e){return e!=null&&typeof e.preventDefault=="function"&&e.preventDefault(),this.collection.currentPage>this.collection.firstPage&&this.collection.requestPreviousPage(),this},r.prototype.nextPage=function(e){return e!=null&&typeof e.preventDefault=="function"&&e.preventDefault(),this.collection.currentPage<this.collection.totalPages-1&&this.collection.requestNextPage(),this},r.prototype.goTo=function(e){var t;if(e.keyCode!==13)return;t=parseInt(this.$(".current-page").val(),10);if(h.isNaN(t)||t<=0||t>this.collection.totalPages){this.update();return}return this.collection.goTo(t-1)},r}(i.View),{Profile:s,Updates:f,ActionBar:r,Sidebar:u}})}).call(this);