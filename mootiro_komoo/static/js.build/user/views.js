(function(){var e=Object.prototype.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["require","jquery","underscore","backbone","reForm","main/views","./forms","text!templates/user/_user_info.html","text!templates/user/_profile.html","map/views","text!templates/user/_sidebar.html","text!templates/user/_update_item.html","text!templates/user/_updates_block.html","widgets/list"],function(e){var n,r,i,s,o,u,a,f,l,c,h,p;return n=e("jquery"),p=e("underscore"),i=e("backbone"),o=e("reForm"),r=e("main/views").ActionBar,c=e("./forms").UserInfoForm,l=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.template=p.template(e("text!templates/user/_user_info.html")),r.prototype.initialize=function(){return p.bindAll(this),this.listenTo(this.model,"change",this.render),this.render()},r.prototype.render=function(){return this.$el.html(this.template({user:this.model.toJSON()}))},r}(i.View),s=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.template=p.template(e("text!templates/user/_profile.html")),r.prototype.initialize=function(){var e,t,n,r;p.bindAll(this),this.subViews=[],this.userInfoViews={view:new l({model:this.model})},this.model.hasPermission("edit")&&(this.userInfoViews.edit=new c({model:this.model,formId:"user-info",submit_label:i18n("Save")}),this.listenTo(this.userInfoViews.edit,"success",this.onSuccess),this.listenTo(this.userInfoViews.edit,"cancel",this.onCancel)),n=this.userInfoViews;for(e in n)t=n[e],this.subViews.push(t);return this.updatesView=new f({collection:this.model.getUpdates()}),this.subViews.push(this.updatesView),this.setMode((r=this.options.mode)!=null?r:"view")},r.prototype.render=function(){var e,t,n,r,i;r=this.subViews;for(t=0,n=r.length;t<n;t++)e=r[t],e.$el.detach();return this.$el.html(this.template({user:this.model.toJSON(),mode:this.mode})),this.$("#user-info-container").append((i=this.userInfoViews[this.mode])!=null?i.$el:void 0),this.$("#user-updates-container").append(this.updatesView.$el),this},r.prototype.canClose=function(){var e;return!((e=this.userInfoViews[this.mode])!=null?typeof e.wasChanged=="function"?e.wasChanged():void 0:void 0)},r.prototype.setMode=function(e){this.mode=e;if(this.mode&&!this.model.hasPermission(this.mode)||this.userInfoViews[this.mode]==null){typeof console!="undefined"&&console!==null&&console.log("Mode '"+this.mode+"' not allowed, changing to 'view'."),this.model.goToProfile();return}return this.userInfoViews[this.mode].render(),this.render()},r.prototype.onSuccess=function(){return i.trigger("change",this.model),this.model.goToProfile()},r.prototype.onCancel=function(){return this.model.goToProfile()},r}(i.View),h=e("map/views"),u=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.template=p.template(e("text!templates/user/_sidebar.html")),r.prototype.initialize=function(){return p.bindAll(this),this.subViews=[],this.subViews.push(new h.Preview({model:this.model,parentSelector:".map.box"})),this.render()},r.prototype.render=function(){var e,t,n,r,i,s,o;s=this.subViews;for(t=0,r=s.length;t<r;t++)e=s[t],e.$el.detach();this.$el.html(this.template({user:this.model.toJSON()})),o=this.subViews;for(n=0,i=o.length;n<i;n++)e=o[n],this.$(e.options.parentSelector).append(e.$el);return this},r}(i.View),a=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.template=p.template(e("text!templates/user/_update_item.html")),r.prototype.tagName="li",r.prototype.events={"click .see-on-map":"seeOnMap"},r.prototype.initialize=function(){return p.bindAll(this),this.listenTo(this.model,"change",this.render),this.render()},r.prototype.render=function(){var e,t;return this.$el.removeClass().addClass([(e=this.model.get("type"))!=null?e.toLowerCase():void 0,(t=this.model.get("action"))!=null?t.toLowerCase():void 0]),this.$el.html(this.template({update:this.model.toJSON()})),this},r.prototype.seeOnMap=function(e){return e!=null&&typeof e.preventDefault=="function"&&e.preventDefault(),this},r}(i.View),f=function(n){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,n),r.prototype.template=p.template(e("text!templates/user/_updates_block.html")),r.prototype.initialize=function(){var t;return p.bindAll(this),t=e("widgets/list"),this.subViews=[],this.subViews.push(new t.List({collection:this.collection,className:"updates list",parentSelector:".list-container",ItemView:a})),this.subViews.push(new t.Pagination({collection:this.collection,parentSelector:".list-container"})),this.render()},r.prototype.render=function(){var e,t,n,r,i,s,o;s=this.subViews;for(t=0,r=s.length;t<r;t++)e=s[t],e.$el.detach();this.$el.html(this.template(this.collection)),o=this.subViews.reverse();for(n=0,i=o.length;n<i;n++)e=o[n],this.$(e.options.parentSelector).prepend(e.$el);return this},r}(i.View),{Profile:s,Updates:f,ActionBar:r,Sidebar:u}})}).call(this);