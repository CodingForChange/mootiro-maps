(function(){var e=Object.prototype.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["require","jquery","underscore","backbone","reForm","./views","new_utils"],function(e){var n,r,i,s,o,u,a;return n=e("jquery"),a=e("underscore"),r=e("backbone"),o=e("reForm"),u=e("./views"),s=e("new_utils"),i=function(e){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.initialize=function(){var e=this;return a.bindAll(this,"root","login"),this.loginView=new u.LoginView,this.loginBox=new s.ModalBox({title:"Login",content:this.loginView.render().el,modal_id:"login-modal-box",onClose:function(t){return e.navigate("",{trigger:!0})}}),n("a.login-required").bind("click.loginrequired",function(t){if(typeof KomooNS!="undefined"&&KomooNS!==null?!KomooNS.isAuthenticated:!void 0)return t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),e.navigate("login",{trigger:!0}),!1}),this.registerBox=new s.ModalBox({title:"Register",content:n("<div>Register modal box</div>"),modal_id:"register-modal-box",onClose:function(t){return e.navigate("",{trigger:!0})}}),this.loginView.$el.find(".auth-register").bind("click",function(t){return t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),e.loginBox.hide(),e.navigate("register",{trigger:!0}),!1})},r.prototype.routes={"":"root",login:"login",register:"register"},r.prototype.root=function(){var e;e=window.location.pathname;if((e==="/user/login/"||e==="/user/login")&&(typeof KomooNS!="undefined"&&KomooNS!==null?!KomooNS.isAuthenticated:!void 0))return this.navigate("login",{trigger:!0})},r.prototype.login=function(){return(typeof KomooNS!="undefined"&&KomooNS!==null?!KomooNS.isAuthenticated:!void 0)?this.loginBox.show():this.navigate("",{trigger:!0})},r.prototype.register=function(){return(typeof KomooNS!="undefined"&&KomooNS!==null?!KomooNS.isAuthenticated:!void 0)?this.registerBox.show():this.navigate("",{trigger:!0})},r}(r.Router),{LoginApp:i}})}).call(this)