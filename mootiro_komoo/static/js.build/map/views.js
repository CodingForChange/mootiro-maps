(function(){var e=Object.prototype.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["require","jquery","underscore","backbone","app","map.jquery"],function(e){var n,r,i,s,o,u,a,f;return n=e("jquery"),f=e("underscore"),r=e("backbone"),u=e("app"),e("map.jquery"),a={},i=function(e){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.initialize=function(){var e,t,r,i,s,o,l=this;return window.d=this,f.bindAll(this),this.listenTo(u,"error",this.onError),this.mapData==null&&(this.mapData={type:this.type}),{mapType:"roadmap",zoom:(e=this.options.zoom)!=null?e:16,geojson:(t=(r=this.options.geojson)!=null?r:(i=this.model)!=null?i.get("geojson"):void 0)!=null?t:{},width:(s=this.options.width)!=null?s:"244px",height:(o=this.options.height)!=null?o:"150px"},a[this.type]!=null?(this.mapElement=a[this.type],this.loaded=!0):(this.mapElement=n("<div>"),this.loaded=!1),this.mapElement.on("initialized",function(){return l.trigger("initialize")}),this.render(),window.pm=this},r.prototype.render=function(){var e=this;return this.mapElement.detach(),this.$el.html('<div class="loading">'+i18n("Loading...")+"</div>"),this.mapElement.one("features_loaded",function(t){return e.mapElement.fadeTo(0,0),e.$el.empty().css({height:"100%"}).append(e.mapElement),e.refresh().fadeTo(100,1),a[e.type]=e.mapElement,e.loaded=!0}),this.loaded?this.mapElement.komooMap("geojson",this.model.get("geojson")):this.mapElement.komooMap(this.mapData),this},r.prototype.onError=function(e){if(!this.loaded&&e.message.indexOf(!1))return this.$el.html('<div class="loading">'+i18n("Map unavailable!")+"</div>")},r.prototype.onOpen=function(){return this.refresh()},r.prototype.remove=function(){return this.mapElement.detach().unbind(),this.mapElement.komooMap("clear"),this.stopListening(),r.__super__.remove.apply(this,arguments)},r.prototype.refresh=function(){return this.mapElement.komooMap("refresh").komooMap("center")},r.prototype.getMap=function(){return this.mapElement.data("map")},r}(r.View),o=function(e){function n(){n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.type="preview",n.prototype.initialize=function(){var e,t,r;return this.mapData={type:this.type,mapType:"roadmap",zoom:(e=this.options.zoom)!=null?e:16,geojson:this.model.get("geojson"),width:(t=this.options.width)!=null?t:"244px",height:(r=this.options.height)!=null?r:"150px"},n.__super__.initialize.apply(this,arguments)},n}(i),s=function(e){function n(){n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.type="main",n.prototype.initialize=function(){var e,t,r,i,s,o;return this.mapData={type:this.type,mapType:"roadmap",zoom:(e=this.options.zoom)!=null?e:16,geojson:(t=(r=this.options.geojson)!=null?r:(i=this.model)!=null?i.get("geojson"):void 0)!=null?t:{},width:(s=this.options.width)!=null?s:"100%",height:(o=this.options.height)!=null?o:"100%"},n.__super__.initialize.apply(this,arguments)},n}(i),{Preview:o,Editor:s}})}).call(this);