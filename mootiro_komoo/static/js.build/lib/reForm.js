(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;l='<form action="" method="post" id="<%= formId %>" >\n    <div>\n        <input type="submit" name="submit" value="<%=submit_label%>" />\n    </div>\n</form>',f='<div class="field-container <%=container_class%>" for="<%=name%>" >\n    <label><%=label%></label>\n    <div class="widget-container">\n    </div>\n</div>',c='<input type="<%=type%>" name="<%=name%>" value="<%=value%>" id="id_<%=name%>" <%=attrs%> />',h='<textarea name="<%=name%>" id="id_<%=name%>" <%=attrs%>><%=value%></textarea>',u='<label>\n  <input type="checkbox" name="<%=name%>" value="<%=choice_value%>" id="id_<%=name%>_<%=choice_num%>" class="checkbox" />\n  <%=choice_title%>\n</label>',a='<select name="<%=name%>" id="id_<%=name%>" <%=attrs%>>\n  <%_.each(choices, function (choice) {%>\n    <option value="<%=choice.value%>" <%=choice.attrs%>><%=choice.title%></option>\n  <% }); %>\n</select>',o=Backbone.View.extend({initialize:function(){var e;return _.bindAll(this),this._template=_.template(this.template),(e=this.options).attrs==null&&(e.attrs=""),this.name=this.options.name},render:function(){return this.$el.html(this._template(this.options)),typeof this.behavior=="function"&&this.behavior(),this},getInputElement:function(){return this.$("input[name="+this.name+"]")},set:function(e){return this.getInputElement().val(e)},get:function(){return this.getInputElement().val()}}),s=o.extend({template:c,initialize:function(){return this.options.type="text",o.prototype.initialize.apply(this,arguments)}}),r=o.extend({template:c,initialize:function(){return this.options.type="password",this.options.value="",this.options.attrs='autocomplete="off"',o.prototype.initialize.apply(this,arguments)}}),i=o.extend({template:h,getInputElement:function(){return this.$("textarea")}}),e=o.extend({template:u,render:function(){var e,t,n,r,i;this.$el.html(""),i=this.options.choices;for(t in i)n=i[t],e=_.extend(this.options,{choice_value:n.value,choice_title:n.title,choice_num:t+1}),r=this._template(e),this.$el.append(r);return this},set:function(e){return e?this.$("input[value="+e+"]").attr("checked",!0):this.$(":checked").attr("checked",!1)},get:function(){var e;return e=this.$(":checked"),e.length?e.val():""}}),t=o.extend({template:a,initialize:function(){var e;return(e=this.options).choices==null&&(e.choices=[]),o.prototype.initialize.apply(this,arguments)},getInputElement:function(){return this.$("select[name="+this.options.name+"]")}}),n=Backbone.View.extend({template:l,initialize:function(){var e,t,n,r,i,s;_.bindAll(this),this._template=_.template(this.template);if((n=this.options)!=null?n.model:void 0)this.model=this.options.model;this.patch=(r=(i=this.options)!=null?i.patch:void 0)!=null?r:!1,this.renderedFields=[],this.instances={},this.on("submit",this.save);if(this.events!=null){s=this.events;for(t in s)e=s[t],this.on(t,this[e])}return this.initializeFields()},render:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h=this;a=this.renderedFields;for(i=0,o=a.length;i<o;i++)t=a[i],t.detach();e=((f=this.options)!=null?f.formId:void 0)||"",r=((l=this.options)!=null?l.submit_label:void 0)||(_.isFunction(window.i18n)?i18n("send"):"send"),n=this._template({formId:e,submit_label:r}),this.$el.html(n),c=this.renderedFields;for(s=0,u=c.length;s<u;s++)t=c[s],this.$("form").prepend(t);return this.$("form").submit(function(e){return e.preventDefault(),h.trigger("submit")}),this.model&&this.set(this.model.toJSON()),this},remove:function(){return Backbone.View.prototype.initialize.apply(this,arguments),this.clearInstances(),this.clearRenderedFields()},clearInstances:function(){var e,t,n,r;n=this.instances,r=[];for(t in n)e=n[t],e.remove(),r.push(this.instances[t]=null);return r},clearRenderedFields:function(){var e,t,n,r;r=this.renderedFields;for(t=0,n=r.length;t<n;t++)e=r[t],e.remove();return this.renderedFields.length=0},initializeFields:function(){var e,t,n,r,i,s,o,u,a,l;a=this.fields.slice(0).reverse(),l=[];for(o=0,u=a.length;o<u;o++)n=a[o],e={name:n.name,input_id:"id_"+n.name,label:n.label||"",value:n.value||"",container_class:n.container_class||""},e=_.extend(e,n.args||{}),i=new n.widget(e),this.instances[n.name]=i,s=_.template(f),t=$("<div>").html(s(e)),r=t.children().detach(),r.find(".widget-container").append(i.render().el),this.$("form").prepend(r),this.renderedFields.push(r),this.model?l.push(this.set(this.model.toJSON())):l.push(void 0);return l},disableSubmit:function(){return this.$("input[type=submit]").attr("disabled","disabled")},enableSubmit:function(){return this.$("input[type=submit]").removeAttr("disabled")},save:function(){var e=this;return this.disableSubmit(),this.model.save(this.get(),{wait:!0,patch:this.patch,success:function(t,n){return e.cleanErrors(),e.enableSubmit(),n.redirect&&(window.location.pathname===n.redirect?window.location.reload():window.location=n.redirect),e.trigger("success",n)},error:function(t,n){return e.enableSubmit(),n=JSON.parse(n.responseText),e.cleanErrors(),e.errors(n.errors||{}),e.trigger("error",n)}})},errors:function(e){var t,n,r,i;this._errors==null&&(this._errors={});if(!e)return this._errors;this._errors=_.extend(this._errors,e);for(r in e)n=e[r],r==="__all__"&&(i=this.$("input[type=submit]"),i.length&&!i.parent().find("small.error").length&&i.before("<small class='error'>"+n+"</small>")),t=this.$(".field-container[for="+r+"]"),t.find("#id_"+r).addClass("error"),t.find("label").addClass("error"),t.find("small.error").length||t.find(".widget-container").after("<small class='error'>"+n+"</smalll>")},cleanErrors:function(){return this.$("small.error").remove(),this.$(".error").removeClass("error")},get:function(e){var t,n,r,i,s;e==null&&(e="__all__");if(e==="__all__"){n={},s=this.fields;for(r=0,i=s.length;r<i;r++)t=s[r],n[t.name]=this.instances[t.name].get();return n}return t=_.find(this.fields,function(t){return t.name===e}),this.instances[t.name].get()},set:function(e){var t,n,r,i,s;e==null&&(e={}),s=[];for(n in e)r=e[n],t=_.find(this.fields,function(e){return e.name===n}),s.push((i=this.instances[t!=null?t.name:void 0])!=null?typeof i.set=="function"?i.set(r):void 0:void 0);return s}}),window.ReForm={Form:n,Widget:o,commonWidgets:{TextWidget:s,PasswordWidget:r,TextAreaWidget:i,CheckboxWidget:e,DropdownWidget:t}},typeof define=="function"&&define.amd&&define([],function(){return window.ReForm})}).call(this);