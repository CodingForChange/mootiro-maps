(function(){var e=Object.prototype.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["require","underscore","reForm"],function(e){var n,r,i,s,o,u;return u=e("underscore"),o=e("reForm"),r='<div class="collection-container <%=container_class%>">\n  <a href="#" class="remove" title="<%=i18n(\'Remove\')%>">[-]</a>\n</div>',i='<div class="field-container <%=container_class%>">\n  <label><%=label%></label>\n  <div class="widget-container"></div>\n</div>',s='<div class="fields-container"></div>\n<a class="add-row"><%=i18n(\'+ Add another one\')%></a>',n=function(e){function n(){n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.fields=[],n.prototype.collectionTemplate=r,n.prototype.fieldTemplate=i,n.prototype.template=s,n.prototype.events={"click .add-row":"onAddClick","click .remove":"onRemoveClick"},n.prototype.initialize=function(){return this.options.type="json",this.rows=0,this.renderedFields=[],n.__super__.initialize.apply(this,arguments)},n.prototype.set=function(e){var t,n,r,i;this.clear();if(u.isArray(e)){i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.addRow(t));return i}},n.prototype.get=function(){var e,t,n,r,i,s,o,a,f,l;i=[],f=this.renderedFields;for(o=0,a=f.length;o<a;o++){e=f[o],t=!0,r={},l=e.data("instances");for(n in l)s=l[n],r[n]=s.get(),r[n]&&(t=!1);t||i.push(r)}return u.isEmpty(i)?null:i},n.prototype.clear=function(){var e,t,n,r,i,s,o;s=this.renderedFields;for(r=0,i=s.length;r<i;r++){e=s[r],o=e.data("instances");for(n in o)t=o[n],t.unbind().remove();e.remove()}return this.rows=0,this.renderedFields.length=0,this},n.prototype.remove=function(){return this.clear(),n.__super__.remove.apply(this,arguments)},n.prototype.onAddClick=function(e){return e.preventDefault(),this.addRow()},n.prototype.onRemoveClick=function(e){var t;return e.preventDefault(),t=$(e.target),t.parent().remove()},n.prototype.addRow=function(e){var t,n,r,i,s,o,a,f,l,c,h,p,d;f=u.template(this.collectionTemplate),l=u.template(this.fieldTemplate),t={name:this.rows,input_id:"id_"+this.rows,container_class:"row"},s=$("<div>").html(f(t)).children().detach(),r={},p=this.fields.slice(0).reverse();for(c=0,h=p.length;c<h;c++)n=p[c],t={name:""+this.name+"_"+n.name+"_"+this.rows,label:n.label||"",value:n.value||"",container_class:n.container_class||""},t=u.extend(t,n.args||{}),a=new n.widget(t),r[n.name]=a,n=$("<div>").html(l(t)).children().detach(),n.find(".widget-container").append(a.render().el),s.prepend(n).data("instances",r);this.$(".fields-container").append(s);for(i in e)o=e[i],(d=r[i])!=null&&d.set(o);return this.renderedFields.push(s),this.rows++,this},n}(o.Widget),{MultiWidget:n}})}).call(this);