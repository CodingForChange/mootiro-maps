/**
 * @license RequireJS text 2.0.3 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/** @license
 * RequireJS plugin for async dependency load like JSONP and Google Maps
 * Author: Miller Medeiros
 * Version: 0.1.1 (2011/11/17)
 * Released under the MIT license
 */

/**
 * Basic parser for URL properties
 * @author Miller Medeiros
 * @version 0.1.0 (2011/12/06)
 * MIT license
 */

/** @license
 * RequireJS plugin for loading Google Ajax API modules thru `google.load`
 * Author: Miller Medeiros
 * Version: 0.2.0 (2011/12/06)
 * Released under the MIT license
 */

/**
 * MultiMarker for Google Maps.
 *
 * @name multimarker.js
 * @fileOverview Group Google Maps Markers together.
 * @version 0.1.0
 * @author Luiz Armesto
 * @copyright (c) 2012 it3s
 */

/**
 * MultiPolyline for Google Maps.
 *
 * @name multipolyline.js
 * @fileOverview Group Google Maps Polylines together.
 * @version 0.1.0
 * @author Luiz Armesto
 * @copyright (c) 2012 it3s
 */

define("common",[],function(){return requirejs.onError=function(e){if(e.requireType==="timeout")return alert("Timeout","Ocorreu uma falha ao carregar alguns serviços externos. Partes do Mootiro Maps poderão não funcionar corretamente."),typeof console!="undefined"&&console!==null?console.error(e):void 0;throw e}});var trans;trans={send:{"pt-br":"enviar"},Login:{"pt-br":"Entrar"},Logout:{"pt-br":"Sair"},Help:{"pt-br":"Ajuda"},Email:{"pt-br":"E-mail"},Password:{"pt-br":"Senha"},Name:{"pt-br":"Nome"},"Password Confirmation":{"pt-br":"Confirmação da Senha"},"Log In with Google":{"pt-br":"Entre com o Google"},"Log In with Facebook":{"pt-br":"Entre com o Facebook"},Register:{"pt-br":"Registrar"},Verification:{"pt-br":"Verificação"},"Your email was successfully verified.":{"pt-br":"Seu email foi verificado com sucesso."},"Please login.":{"pt-br":"Por favor, faça login ao lado."},'I\'ve read and accept the <a href="http://mootiro.org/terms">License Terms.</a>':{"pt-br":'Eu li e aceito os <a href="http://mootiro.org/terms">Termos de Uso</a>.'},"Already has an account? <strong>Sign In</strong>":{"pt-br":"Já possui uma conta? <strong>Entre</strong>"},"Don't have an account? <strong>Sign Up</strong>":{"pt-br":"Não possui uma conta? <strong>Registre-se</strong>"},or:{"pt-br":"ou"},"Your account was created!":{"pt-br":"Sua conta foi criada!"},"But before using, you have to confirm your email":{"pt-br":"Mas antes de começar a usar, você precisa confirmar seu e-mail"},"Please go check your mail box":{"pt-br":"Por favor, vá checar sua caixa postal"},Search:{"pt-br":"Procurar"},"See results":{"pt-br":"Ver resultados"},"More about":{"pt-br":"Saiba mais"},"About MootiroMaps":{"pt-br":"Sobre o MootiroMaps"},"About Us":{"pt-br":"Quem somos"},"Get involved":{"pt-br":"Se envolva"},Supporters:{"pt-br":"Apoio institucional"}},window.i18n=function(e){var t,n;return t=KomooNS.lang,((n=trans[e])!=null?n[t]:void 0)?trans[e][t]:e},define("i18n",[],function(){}),define("event_aggregator",["require","underscore","backbone"],function(e){var t,n;return n=e("underscore"),t=e("backbone"),n.extend({},t.Events)}),define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.3",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+"."+s.ext,h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.moduleName+"."+o.ext,a=r.toUrl(o.moduleName+"."+o.ext)+".js";t.load(u,r,function(n){var r=function(e){return i(a,e)};r.asModule=function(e,t){return i.asModule(e,a,t)},t.write(e,u,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),c.onXhr&&c.onXhr(i,e),i.onreadystatechange=function(t){var s,o;i.readyState===4&&(s=i.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=i,r(o)):n(i.responseText))},i.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!templates/main/_header.html",[],function(){return'<header class="main">\n\n  <div class="content">\n\n    <div id="upper-bar-container"></div>\n\n    <h1 class="logo"><a href="/" title="Página principal">MootiroMaps</a></h1>\n\n    <nav>\n      <ul>\n        <li class="map"><a href="#">Mapa</a></li>\n        <li class="communities"><a href="#">Comunidades</a></li>\n        <li class="places has-submenu">\n          <a href="#">Locais</a>\n          <ul>\n            <li class="needs"><a href="#">Necessidades</a></li>\n            <li class="organizations"><a href="#">Organizações</a></li>\n            <li class="resources"><a href="#">Recursos</a></li>\n            <li class="investments"><a href="#">Investimentos</a></li>\n          </ul>\n        </li>\n        <li class="projects"><a href="#">Projetos</a></li>\n      </ul>\n    </nav>\n\n  </div>\n\n</header>\n'}),define("text!templates/main/_upper_bar.html",[],function(){return'<section class="upper-bar">\n  <form action="#" class="search">\n    <input type="text" name="query" placeholder="<% i18n(\'Search\') %>" value="" />\n    <input type="submit" value="<%= i18n(\'See results\') %>" />\n  </form>\n  <ul class="nav">\n  <% if (KomooNS.isAuthenticated) { %>\n    <li><a href="#" class="logout"><%= i18n(\'Logout\') %></a></li>\n    <li><a href="<%= KomooNS.user.url %>" class="user"><%= KomooNS.user.name %></a></li>\n  <% } else { %>\n    <li><a href="#" class="login login-required" ><%= i18n(\'Login\') %></a></li>\n  <% } %>\n  <li><a href="http://pt.wikiboks.org/wiki/MootiroMaps" target="_blank" class="help"><%= i18n(\'Help\') %></a></li>\n  </ul>\n</section>\n'});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("main/upper_bar",["require","jquery","underscore","backbone","text!templates/main/_upper_bar.html"],function(e){var t,n,r,i,s;return t=e("jquery"),s=e("underscore"),n=e("backbone"),i=e("text!templates/main/_upper_bar.html"),r=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.template=s.template(i),t.prototype.events={"click .login":"login","click .logout":"logout"},t.prototype.initialize=function(e){return this.options=e,s.bindAll(this),this.vent=this.options.vent,this.render()},t.prototype.render=function(){var e;return e=this.template(),this.$el.html(e),this},t.prototype.login=function(){return this.vent.trigger("auth:loginRequired",window.location.href)},t.prototype.logout=function(){return this.vent.trigger("auth:logout",window.location.href)},t}(n.View),r});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("main/header",["require","jquery","underscore","backbone","text!templates/main/_header.html","main/upper_bar"],function(e){var t,n,r,i,s;return t=e("jquery"),s=e("underscore"),n=e("backbone"),i=e("text!templates/main/_header.html"),r=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.template=s.template(i),n.prototype.events={},n.prototype.initialize=function(){var t;return this.vent=this.options.vent,delete this.options.el,t=e("main/upper_bar"),this.upperBar=new t(this.options),s.bindAll(this),this.render()},n.prototype.render=function(){var e;return e=this.template(),this.$el.html(e),this.$el.find("#upper-bar-container").append(this.upperBar.$el),this},n}(n.View),r}),define("text!templates/main/_footer.html",[],function(){return'<section class="footer">\n  <hr />\n  <div>\n    <h3><%= i18n(\'More about\') %></h3>\n    <ul>\n      <li><a href="/about"><%= i18n(\'About MootiroMaps\') %></a></li>\n      <li><%= i18n(\'About Us\') %></li>\n      <li><%= i18n(\'Get Involved\') %></li>\n    </ul>\n  </div>\n  <div class="supporters">\n    <h3><%= i18n(\'Supporters\') %></h3>\n    <a href="http://www.institutocea.org.br/" target="_blank"><img class="cea-logo" src="<%= KomooNS.staticUrl %>img/supporters/cea-footer.png" alt="Instituto C&amp;A" /></a>\n  </div>\n  <div class="license">\n    <strong>Licença:</strong> Este texto é disponibilizado nos termos da licença <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.pt_BR">Creative Commons - Atribuição - Partilha nos Mesmos Termos 3.0 Não Adaptada</a>; pode estar sujeito a condições adicionais. Para mais detalhes, consulte as Condições de Uso.\n  </div>\n</section>\n'});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("main/footer",["require","jquery","underscore","backbone","text!templates/main/_footer.html"],function(e){var t,n,r,i,s;return t=e("jquery"),s=e("underscore"),n=e("backbone"),i=e("text!templates/main/_footer.html"),r=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.template=s.template(i),t.prototype.events={},t.prototype.initialize=function(){return this.vent=this.options.vent,console.log(this.vent),s.bindAll(this),this.render()},t.prototype.render=function(){var e;return e=this.template(),this.$el.html(e),this},t}(n.View),r});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("authentication/models",["require","jquery","underscore","backbone"],function(e){var t,n,r,i,s,o;return t=e("jquery"),o=e("underscore"),n=e("backbone"),r=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.urlRoot="/api/user/login/",t}(n.Model),i=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.urlRoot="/api/user/logout/",t.prototype.initialize=function(){return o.bindAll(this)},t.prototype.doLogout=function(e){var t=this;return this.set({next:e}),n.sync("read",this,{data:{next:e},success:function(e){if(e.redirect)return window.location.pathname===e.redirect?window.location.reload():window.location=e.redirect}})},t}(n.Model),s=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.urlRoot="/api/user/",t}(n.Model),{LoginModel:r,LogoutModel:i,User:s}}),define("text!templates/widgets/_signup.html",[],function(){return'<span class="small">\n  <a href="#register" class="auth-register"><%= i18n("Don\'t have an account? <strong>Sign Up</strong>") %><a/>\n</span>\n\n'}),define("text!templates/widgets/_signin.html",[],function(){return'\n<span class="small">\n  <a href="#login" class="auth-login"> <%= i18n(\'Already has an account? <strong>Sign In</strong>\') %><a/>\n</span>\n\n'});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("authentication/forms",["require","reForm","text!templates/widgets/_signup.html","text!templates/widgets/_signin.html"],function(e){var t,n,r,i,s,o,u;return s=e("reForm"),u=e("text!templates/widgets/_signup.html"),o=e("text!templates/widgets/_signin.html"),i=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.template=u,t.prototype.get=function(){return""},t}(s.Widget),r=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.template=o,t.prototype.get=function(){return""},t}(s.Widget),t=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.fields=[{name:"email",widget:s.commonWidgets.TextWidget,label:i18n("Email")},{name:"password",widget:s.commonWidgets.PasswordWidget,label:i18n("Password")},{name:"signup",widget:i}],t.prototype.render=function(){var e=this;return t.__super__.render.apply(this,arguments),this.$el.find(".auth-register").bind("click",function(t){return t.preventDefault(),e.trigger("register-link:click"),!1}),this},t}(s.Form),n=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.fields=[{name:"name",widget:s.commonWidgets.TextWidget,label:i18n("Name")},{name:"email",widget:s.commonWidgets.TextWidget,label:i18n("Email")},{name:"password",widget:s.commonWidgets.PasswordWidget,label:i18n("Password"),container_class:"half-box-left"},{name:"password_confirm",widget:s.commonWidgets.PasswordWidget,label:i18n("Password Confirmation"),container_class:"half-box-right"},{name:"license",widget:s.commonWidgets.CheckboxWidget,args:{choices:[{value:"agree",title:i18n('I\'ve read and accept the <a href="http://mootiro.org/terms">License Terms.</a>')}]}},{name:"signin",widget:r}],t.prototype.render=function(){var e=this;return t.__super__.render.apply(this,arguments),this.$el.find(".auth-login").bind("click",function(t){return t.preventDefault(),e.trigger("login-link:click"),!1}),this},t}(s.Form),{LoginForm:t,RegisterForm:n}}),define("text!templates/authentication/_login.html",[],function(){return'  <div>\n    <div class="social_buttons"></div>\n\n    <div class="separator">\n      <div class="vertical_line top"></div>\n      <span><%= i18n(\'or\') %></span>\n      <div class="vertical_line bottom"></div>\n    </div>\n\n    <div class="login_form"></div>\n  </div>\n\n  <div class="clear-both"></div>\n\n'}),define("text!templates/authentication/_register.html",[],function(){return'<div class="form-wrapper"></div>\n'}),define("text!templates/authentication/_social_button.html",[],function(){return'<a href="<%= url %>" class="button fixed <%= provider %>">\n  <%= msg %>\n</a>\n'}),define("text!templates/authentication/_not_verified.html",[],function(){return"<section class=\"auth-not-verified\">\n  <img src=\"/static/img/spock-email.png\" alt=\"check your email image\" />\n  <article>\n  <header><h1><%= i18n('Your account was created!')%></h1></header>\n\n    <p><%= i18n('But before using, you have to confirm your email')%>.</p>\n    <p><%= i18n('Please go check your mail box') %>.</p>\n  </article>\n</section>\n"}),define("text!templates/authentication/_verified.html",[],function(){return'<div class="auth-verified">\n  <div class="half-box-left verified-msg">\n      <p><%= i18n(\'Your email was successfully verified.\') %></p>\n      <p><%= i18n(\'Please login.\') %></p>\n  </div>\n  <div class="half-box-right login-form-box"></div>\n</div>\n'});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("authentication/views",["require","underscore","backbone","./models","./forms","text!templates/authentication/_login.html","text!templates/authentication/_register.html","text!templates/authentication/_social_button.html","text!templates/authentication/_not_verified.html","text!templates/authentication/_verified.html"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;return v=e("underscore"),t=e("backbone"),l=e("./models"),a=e("./forms"),f=e("text!templates/authentication/_login.html"),h=e("text!templates/authentication/_register.html"),p=e("text!templates/authentication/_social_button.html"),c=e("text!templates/authentication/_not_verified.html"),d=e("text!templates/authentication/_verified.html"),s=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="li",t.prototype.template=v.template(p),t.prototype.initialize=function(){return v.bindAll(this,"render"),this.className=this.options.provider,this.url=""+this.options.url+"?next="+(this.options.next||""),this.image_url=this.options.image_url,this.msg=this.options.message,this.provider=this.options.provider},t.prototype.render=function(){var e;return e=this.template({provider:this.provider,url:this.url,image_url:this.image_url,msg:this.msg}),this.$el.html(e),this.$el.addClass(this.className),this},t}(t.View),o=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.tagName="ul",t.prototype.className="external_providers",t.prototype.initialize=function(){return v.bindAll(this,"render"),this.buttons=this.options.buttons},t.prototype.render=function(){var e,t=this;return e=this.buttons,this.$el.html(""),v.each(e,function(e){var n;return n=new s(e),t.$el.append(n.render().el)}),this},t}(t.View),n=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.className="login_box",t.prototype.tagName="section",t.prototype.template=v.template(f),t.prototype.initialize=function(){var e,t;return v.bindAll(this),e=((t=this.options)!=null?t.next:void 0)||"",this.buildButtons(e),this.model=new l.LoginModel({}),this.form=new a.LoginForm({formId:"form_login",model:this.model})},t.prototype.render=function(){var e;return e=this.template({}),this.$el.html(e),this.$el.find(".social_buttons").append(this.socialBtnsView.render().el),this.$el.find(".login_form").append(this.form.render().el),this},t.prototype.buildButtons=function(e){var t,n;return e==null&&(e=""),n={provider:"google",url:dutils.urls.resolve("login_google"),next:e,image_url:"/static/img/login-google.png",message:i18n("Log In with Google")},t={provider:"facebook",url:dutils.urls.resolve("login_facebook"),next:e,image_url:"/static/img/login-facebook.png",message:i18n("Log In with Facebook")},this.socialBtnsView=new o({buttons:[n,t]})},t.prototype.updateUrls=function(e){return e==null&&(e=""),this.model.set({next:e}),this.buildButtons(e),this.render(),this},t}(t.View),r=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.initialize=function(e){return this.options=e,v.bindAll(this),this.model=new l.LogoutModel({})},t.prototype.logout=function(e){return this.model.doLogout(e)},t.prototype.bindLogoutButton=function(){var e=this;return $(".logout").click(function(t){var n;return t.preventDefault(),n=$(t.target).attr("href"),(n!=null?n.charAt(0):void 0)==="#"&&(n=document.location.pathname+n),e.logout(n),!1})},t}(t.View),i=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.template=v.template(h),t.prototype.className="register",t.prototype.tagName="section",t.prototype.initialize=function(){var e;return v.bindAll(this),e=new l.User({}),this.form=new a.RegisterForm({formId:"form_register",submit_label:i18n("Register"),model:e})},t.prototype.render=function(){var e;return e=this.template({}),this.$el.html(e),this.$el.find(".form-wrapper").append(this.form.render().el),this},t}(t.View),u=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.initialize=function(){return v.bindAll(this),this.verified=this.options.verified,this.verified?(this.template=v.template(d),this.loginModel=new l.LoginModel({}),this.loginForm=new a.LoginForm({model:this.loginModel})):this.template=v.template(c)},t.prototype.render=function(){var e;return e=this.template({}),this.$el.html(e),this.verified&&this.$el.find(".login-form-box").append(this.loginForm.render().el),this},t}(t.View),{LoginView:n,LogoutView:r,RegisterView:i,VerificationView:u}}),define("text!templates/widgets/_modal_box.html",[],function(){return'<div id="<%= modal_id %>" class="modal" style="display: none">\n  <div class="modal-bg"></div>\n  <div class="dialog-container">\n    <article class="dialog">\n      <header>\n        <button class="close">Fechar</button>\n        <h1><%= title %></h1>\n      </header>\n      <section class="content"></section>\n    </article>\n  </div>\n</div>\n'});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("new_utils",["require","jquery","underscore","backbone","text!templates/widgets/_modal_box.html"],function(e){var t,n,r,i,s,o;return t=e("jquery"),o=e("underscore"),n=e("backbone"),s=e("text!templates/widgets/_modal_box.html"),i=function(e){var n;if(!t('link[href="'+e+'"]').length)return typeof console!="undefined"&&console!==null&&typeof console.log=="function"&&console.log("Loading css: ",e),n=document.createElement("link"),n.type="text/css",n.rel="stylesheet",n.href=e,document.getElementsByTagName("head")[0].appendChild(n)},r=function(e){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.template=o.template(s),n.prototype.events={"click .close":"close","click .modal-bg":"close"},n.prototype.initialize=function(){var e;return o.bindAll(this),this.tpl_args=o.extend({tile:"",modal_id:"modal-box"},this.options),this.content=(e=this.options.content)!=null?e:"",this.options.width&&(this.width=this.options.width),this.render()},n.prototype.render=function(){var e;return e=this.template(this.tpl_args),this.$el.html(e),t("body").append(this.el),this.$el.find(".content").append(this.content),this.modal=this.$el.find("#"+this.tpl_args.modal_id),this.width!=null&&this.modal.find(".dialog").css("width",this.width),this},n.prototype.open=function(){return this.modal.fadeIn(),this.trigger("open"),this},n.prototype.close=function(){return this.modal.fadeOut(),this.trigger("close"),this},n}(n.View),{loadCss:i,ModalBox:r}});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("authentication/router",["require","jquery","underscore","backbone","reForm","./views","new_utils","text!templates/authentication/_not_verified.html","text!templates/authentication/_verified.html"],function(e){var t,n,r,i,s,o,u,a,f;return t=e("jquery"),f=e("underscore"),n=e("backbone"),o=e("reForm"),a=e("./views"),i=e("new_utils"),s=e("text!templates/authentication/_not_verified.html"),u=e("text!templates/authentication/_verified.html"),r=function(e){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype.routes={"":"root",login:"login",register:"register","not-verified":"not_verified",verified:"verified"},n.prototype.initialize=function(e){return this.options=e,f.bindAll(this),this.initializeLogin(),this.initializeLogout(),this.initializeRegister(),this.initializeVerification(),this.bindExternalEvents()},n.prototype.initializeLogin=function(){var e=this;return this.loginView=new a.LoginView({}),this.loginView.form.on("register-link:click",this.registerLinkCB),this.loginBox=new i.ModalBox({title:i18n("Login"),content:this.loginView.render().el,modal_id:"login-modal-box"}),this.loginBox.on("close",this._onClose),t("a.login-required").bind("click.loginrequired",function(n){var r;if(typeof KomooNS!="undefined"&&KomooNS!==null?!KomooNS.isAuthenticated:!void 0)return n.preventDefault(),r=t(n.target).attr("href"),(r!=null?r.charAt(0):void 0)==="#"&&(r=document.location.pathname+r),e._loginRequired(r),!1})},n.prototype.initializeLogout=function(){return this.logoutView=new a.LogoutView({})},n.prototype.initializeRegister=function(){return this.registerView=new a.RegisterView({}),this.registerView.form.on("success",this.registerFormOnSuccessCB),this.registerView.form.on("login-link:click",this.loginLinkCB),this.registerBox=new i.ModalBox({title:i18n("Register"),width:"450px",content:this.registerView.render().el,modal_id:"register-modal-box"}),this.registerBox.on("close",this._onClose)},n.prototype.initializeVerification=function(){return this.notVerifiedView=new a.VerificationView({verified:!1}),this.verifiedView=new a.VerificationView({verified:!0}),this.verifiedView.loginForm.on("register-link:click",this.registerLinkCB),this.notVerifiedBox=new i.ModalBox({title:i18n("Verification"),content:this.notVerifiedView.render().el,modal_id:"verification-modal-box"}),this.notVerifiedBox.on("close",this._onClose),this.verifiedBox=new i.ModalBox({title:i18n("Verification"),content:this.verifiedView.render().el,modal_id:"verification-modal-box"}),this.verifiedBox.on("close",this._onClose)},n.prototype.bindExternalEvents=function(){return this.vent=this.options.vent,this.vent.on("auth:loginRequired",this._loginRequired),this.vent.on("auth:logout",this.logoutView.logout)},n.prototype.registerLinkCB=function(){return this.navigate("register",{trigger:!0})},n.prototype.loginLinkCB=function(){return this.navigate("login",{trigger:!0})},n.prototype.registerFormOnSuccessCB=function(){return this.navigate("not-verified",{trigger:!0})},n.prototype._onClose=function(){return this.navigate("",{})},n.prototype._loginRequired=function(e){if(typeof KomooNS!="undefined"&&KomooNS!==null?!KomooNS.isAuthenticated:!void 0)return e&&this.loginView.updateUrls(e),this.navigate("login",{trigger:!0})},n.prototype.root=function(){var e,t,n,r;t=window.location.pathname;if((t==="/user/"||t==="/user")&&(typeof KomooNS!="undefined"&&KomooNS!==null?!KomooNS.isAuthenticated:!void 0))return r=window.location,r.search&&r.search.indexOf("next")>-1&&(n={},r.search.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,t,r,i){return n[t]=i}),e=n.next,this.loginView.updateUrls(e)),this.navigate("login",{trigger:!0})},n.prototype.login=function(){return this.closeModals("login"),(typeof KomooNS!="undefined"&&KomooNS!==null?!KomooNS.isAuthenticated:!void 0)?this.loginBox.open():this.navigate("",{trigger:!0})},n.prototype.register=function(){return this.closeModals("register"),(typeof KomooNS!="undefined"&&KomooNS!==null?!KomooNS.isAuthenticated:!void 0)?this.registerBox.open():this.navigate("",{trigger:!0})},n.prototype.not_verified=function(){var e;return this.closeModals("not-verified"),e=window.location.pathname,this.notVerifiedBox.open()},n.prototype.verified=function(){var e;return this.closeModals("verified"),e=window.location.pathname,this.verifiedBox.open()},n.prototype.closeModals=function(e){var t,n,r,i;i=[this.loginBox,this.registerBox,this.verifiedBox,this.notVerifiedBox];for(n=0,r=i.length;n<r;n++)t=i[n],t.close();return this.navigate(e)},n}(n.Router),{LoginApp:r}}),define("analytics",[],function(){return{init:function(){var e=e||[];e.push(["_setAccount","UA-31165229-1"]),e.push(["_setDomainName","mootiro.org"]),e.push(["_setAllowLinker",!0]),e.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()}}}),define("facebook-jssdk",["jquery"],function(e){return{init:function(t){var n=e('<div id="fb-root" />');e("body").prepend(n),function(e,n,r){var i,s=e.getElementsByTagName(n)[0];if(e.getElementById(r))return;i=e.createElement(n),i.id=r,i.src="//connect.facebook.net/en_US/all.js#xfbml=1&appId="+t,s.parentNode.insertBefore(i,s)}(document,"script","facebook-jssdk")}}}),define("app",["require","common","jquery","backbone","event_aggregator","main/header","main/footer","authentication/router","analytics","facebook-jssdk"],function(e){var t,n,r,i,s,o,u,a,f,l;return e("common"),t=e("jquery"),n=e("backbone"),l=e("event_aggregator"),i=e("main/header"),f=new i({el:"#header-container",vent:l}),r=e("main/footer"),a=new r({el:"#footer-container",vent:l}),o=e("authentication/router"),t(function(){var e;return e=new o.LoginApp({vent:l}),n.history.start()}),s=e("analytics"),s.init(),u=e("facebook-jssdk"),u.init(typeof KomooNS!="undefined"&&KomooNS!==null?KomooNS.facebookAppId:void 0),{start:function(t){if(t!=null)return e([t])}}}),define("async",[],function(){function n(e){var t,n;t=document.createElement("script"),t.type="text/javascript",t.async=!0,t.src=e,n=document.getElementsByTagName("script")[0],n.parentNode.insertBefore(t,n)}function r(t,n){var r=/!(.+)/,i=t.replace(r,""),s=r.test(t)?t.replace(/.+!/,""):e;return i+=i.indexOf("?")<0?"?":"&",i+s+"="+n}function i(){return t+=1,"__async_req_"+t+"__"}var e="callback",t=0;return{load:function(e,t,s,o){if(o.isBuild)s(null);else{var u=i();window[u]=s,n(r(e,u))}}}}),define("propertyParser",[],function(){function n(t){var n,i={};while(n=e.exec(t))i[n[1]]=r(n[2]||n[3]);return i}function r(e){return t.test(e)?e=e.replace(t,"$1").split(","):e==="null"?e=null:e==="false"?e=!1:e==="true"?e=!0:e===""||e==="''"||e==='""'?e="":isNaN(e)||(e=+e),e}var e=/([\w-]+)\s*:\s*(?:(\[[^\]]+\])|([^,]+)),?/g,t=/^\[([^\]]+)\]$/;return{parseProperties:n,typecastVal:r}}),define("goog",["async","propertyParser"],function(e,t){function r(e){var r=n.exec(e),i={moduleName:r[1],version:r[2]||"1"};return i.settings=t.parseProperties(r[3]),i}var n=/^([^,]+)(?:,([^,]+))?(?:,(.+))?/;return{load:function(e,t,n,i){if(i.isBuild)n(null);else{var s=r(e),o=s.settings;o.callback=n,t(["async!"+(document.location.protocol==="https:"?"https":"http")+"://www.google.com/jsapi"],function(){google.load(s.moduleName,s.version,o)})}}}}),define("googlemaps",["goog!maps,3,other_params:[sensor=false&libraries=drawing&language=pt-br]"],function(){return google.maps}),define("map/component",["jquery"],function(e){var t,n;return t=function(){function t(t,n){this.mediator=t,this.el=n,this.map=this.mediator,this.$el=e(document).find(this.el)}return t.prototype.name="Base Component",t.prototype.description="",t.prototype.enabled=!1,t.prototype.setMap=function(e){this.map=e},t.prototype.enable=function(){return this.enabled=!0},t.prototype.disable=function(){return this.enabled=!1},t.prototype.init=function(t){return e.when(t)},t.prototype.destroy=function(){return!0},t}(),n=t,n}),define("map/common",[],function(){return{geometries:{types:{EMPTY:"Empty",POINT:"Point",MULTIPOINT:"MultiPoint",POLYGON:"Polygon",POLYLINE:"LineString",LINESTRING:"LineString",MULTIPOLYLINE:"MultiLineString",MULTILINESTRING:"MultiLineString"}}}}),define("map/multimarker",["googlemaps"],function(e){return MultiMarker=function(t){t=t||{},this.markers_=new e.MVCArray(t.markers||[]),this.positions_=new e.MVCArray(t.positions||[]),this.map_=t.map,this.visible_=t.visible,this.clickable_=t.clickable,this.draggable_=t.draggable,this.icon_=t.icon,this.zIndex=t.zIndex||0},MultiMarker.prototype.getPosition=function(){var e;return(e=this.markers_.getAt(0))?e.getPosition():null},MultiMarker.prototype.getPositions=function(){this.positions_.clear();for(var e=0;e<this.markers_.getLength();e++)this.positions_.push(this.markers_.getAt(e).getPosition());return this.positions_},MultiMarker.prototype.setPositions=function(e){if(e.length!=this.markers_.getLength())throw"Invalid length.";this.positions_.clear();for(var t=0;t<this.markers_.getLength();t++)this.markers_.getAt(t).setPosition(e[t]),this.positions_.push(e[t])},MultiMarker.prototype.addMarker=function(t,n){var r=this;this.markers_.push(t),n||this.icon_&&t.setIcon(this.icon_),e.event.addListener(t,"click",function(n){e.event.trigger(r,"click",n,t)}),e.event.addListener(t,"mouseover",function(n){e.event.trigger(r,"mouseover",n,t)}),e.event.addListener(t,"mouseout",function(n){e.event.trigger(r,"mouseout",n,t)}),e.event.addListener(t,"mousemove",function(n){e.event.trigger(r,"mousemove",n,t)})},MultiMarker.prototype.addMarkers=function(e,t){for(var n=0;n<e.length;n++)this.addMarker(e[n],t)},MultiMarker.prototype.getMarkers=function(){return this.markers_},MultiMarker.prototype.setDraggable=function(e){for(var t=0;t<this.markers_.getLength();t++)this.markers_.getAt(t).setDraggable(e);this.draggable_=e},MultiMarker.prototype.getDraggable=function(){return this.draggable_},MultiMarker.prototype.setMap=function(e){for(var t=0;t<this.markers_.getLength();t++)this.markers_.getAt(t).setMap(e);this.map_=e},MultiMarker.prototype.getMap=function(){return this.map_},MultiMarker.prototype.setIcon=function(e){for(var t=0;t<this.markers_.getLength();t++)this.markers_.getAt(t).setIcon(e);this.icon_=e},MultiMarker.prototype.getIcon=function(){return this.icon_},MultiMarker.prototype.setVisible=function(e){for(var t=0;t<this.markers_.getLength();t++)this.markers_.getAt(t).setVisible(e);this.visible_=e},MultiMarker.prototype.getVisible=function(){return this.visible_},MultiMarker}),define("map/multipolyline",["googlemaps"],function(e){return MultiPolyline=function(t){t=t||{},this.polylines_=new e.MVCArray(t.polylines||[]),this.paths_=new e.MVCArray(t.paths||[]),this.map_=t.map,this.visible_=t.visible,this.clickable_=t.clickable,this.zIndex=t.zIndex||0,this.strokeColor_=t.strokeColor||"black",this.strokOpacity_=t.strokeOpacity||1,this.strokeWeight_=t.strokeWeight||3},MultiPolyline.prototype.getPaths=function(){this.paths_.clear();for(var e=0;e<this.polylines_.getLength();e++)this.paths_.push(this.polylines_.getAt(e).getPath());return this.paths_},MultiPolyline.prototype.setPaths=function(e){if(e.length!=this.polylines_.getLength())throw"Invalid length.";this.paths_.clear();for(var t=0;t<this.polylines_.getLength();t++)this.polylines_.getAt(t).setPath(e[t]),this.paths_.push(e[t])},MultiPolyline.prototype.addPolyline=function(t,n){var r=this;this.polylines_.push(t),n!=1&&t.setOptions({clickable:this.clickable_,zIndex:this.zIndex,strokeColor:this.strokeColor_,strokeOpacity:this.strokOpacity_,strokeWeight:this.strokeWeight_}),e.event.addListener(t,"click",function(n){e.event.trigger(r,"click",n,t)}),e.event.addListener(t,"mouseover",function(n){e.event.trigger(r,"mouseover",n,t)}),e.event.addListener(t,"mouseout",function(n){e.event.trigger(r,"mouseout",n,t)}),e.event.addListener(t,"mousemove",function(n){e.event.trigger(r,"mousemove",n,t)})},MultiPolyline.prototype.addPolylines=function(e,t){for(var n=0;n<e.length;n++)this.addPolyline(e[n],t)},MultiPolyline.prototype.getPolylines=function(){return this.polylines_},MultiPolyline.prototype.setMap=function(e){for(var t=0;t<this.polylines_.getLength();t++)this.polylines_.getAt(t).setMap(e);this.map_=e},MultiPolyline.prototype.getMap=function(){return this.map_},MultiPolyline.prototype.setVisible=function(e){for(var t=0;t<this.polylines_.getLength();t++)this.polylines_.getAt(t).setVisible(e);this.visible_=e},MultiPolyline.prototype.setEditable=function(e){for(var t=0;t<this.polylines_.getLength();t++)this.polylines_.getAt(t).setEditable(e);this.visible_=e},MultiPolyline.prototype.setOptions=function(e){for(var t=0;t<this.polylines_.getLength();t++)this.polylines_.getAt(t).setOptions(e);this.options_=e},MultiPolyline.prototype.getVisible=function(){return this.visible_},MultiPolyline});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("map/geometries",["googlemaps","map/common","map/multimarker","map/multipolyline"],function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;return window.komoo==null&&(window.komoo={}),(b=window.komoo).event==null&&(b.event=e.event),n=t.geometries.types.EMPTY,h=t.geometries.types.POINT,a=t.geometries.types.MULTIPOINT,p=t.geometries.types.POLYGON,d=t.geometries.types.LINESTRING,s=t.geometries.types.LINESTRING,f=t.geometries.types.MULTILINESTRING,u=t.geometries.types.MULTILINESTRING,y={BACKGROUND_COLOR:"#000",BACKGROUND_OPACITY:.6,BORDER_COLOR:"#000",BORDER_OPACITY:.6,BORDER_SIZE:1.5,BORDER_SIZE_HOVER:2.5,ZINDEX:1},i=function(){function t(e){this.options=e!=null?e:{},this.setFeature(this.options.feature),this.initOverlay(this.options)}return t.prototype.initOverlay=function(e){throw"Not Implemented"},t.prototype.getCoordinates=function(){throw"Not Implemented"},t.prototype.setCoordinates=function(e){return komoo.event.trigger(this,"coordinates_changed")},t.prototype.setEditable=function(e){throw"Not Implemented"},t.prototype.initEvents=function(e){var t,n=this;e==null&&(e=this.overlay);if(!e)return;return t=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"],t.forEach(function(t){return komoo.event.addListener(e,t,function(e,r){return komoo.event.trigger(n,t,e,r)})})},t.prototype.calculateBounds=function(){var t,n,r,i,s,o,u,a,l,c,h,d,v,m;o=l=c=r=null,s=function(e){return o==null&&(o=l!=null?l:l=e[0]),c==null&&(c=r!=null?r:r=e[1]),o=Math.max(e[0],o),l=Math.min(e[0],l),c=Math.min(e[1],c),r=Math.max(e[1],r),[[l,c],[o,r]]},n=this.getCoordinates(),i=this.getGeometryType(),i!==p&&i!==f&&(n=[n]);for(h=0,v=n.length;h<v;h++){u=n[h];for(d=0,m=u.length;d<m;d++)a=u[d],t=s(a)}return t!=null&&(this.bounds=new e.LatLngBounds(this.getLatLngFromArray(t[0]),this.getLatLngFromArray(t[1]))),this.bounds},t.prototype.getBounds=function(){return this.bounds!=null?this.bounds:this.calculateBounds()},t.prototype.getCenter=function(){var e,t,n;return this.overlay?this.getArrayFromLatLng((typeof (e=this.overlay).getCenter=="function"?e.getCenter():void 0)||((n=this.getBounds())!=null?n.getCenter():void 0)||(typeof (t=this.overlay).getPosition=="function"?t.getPosition():void 0)):[]},t.prototype.getOverlay=function(){return this.overlay},t.prototype.setOverlay=function(e){return this.overlay=e,this.initEvents()},t.prototype.getFeature=function(){return this.feature},t.prototype.setFeature=function(e){this.feature=e},t.prototype.getGeometryType=function(){return this.geometryType},t.prototype.getDefaultZIndex=function(){var e;return((e=this.feature)!=null?e.getDefaultZIndex():void 0)||y.ZINDEX},t.prototype.getLatLngFromArray=function(t){return t!=null?new e.LatLng(t[0],t[1]):null},t.prototype.getArrayFromLatLng=function(e){return e?[e.lat(),e.lng()]:[]},t.prototype.getLatLngArrayFromArray=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.getLatLngFromArray(t));return i},t.prototype.getArrayFromLatLngArray=function(e){var t,n,r,i;if(e){i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.getArrayFromLatLng(t));return i}return[]},t.prototype.getMap=function(){return this.map},t.prototype.setMap=function(e){var t;return this.map=e,(t=this.overlay)!=null?t.setMap(this.map&&this.map.googleMap?this.map.googleMap:this.map):void 0},t.prototype.getVisible=function(){var e;return(e=this.overlay)!=null?e.getVisible():void 0},t.prototype.setVisible=function(e){var t;return(t=this.overlay)!=null?t.setVisible(e):void 0},t.prototype.setOptions=function(e){var t;return this.options=e,(t=this.overlay)!=null?t.setOptions(this.options):void 0},t.prototype.getIcon=function(){var e;return(e=this.overlay)!=null?typeof e.getIcon=="function"?e.getIcon():void 0:void 0},t.prototype.setIcon=function(e){var t;return(t=this.overlay)!=null?typeof t.setIcon=="function"?t.setIcon(e):void 0:void 0},t.prototype.getIconUrl=function(e){var t;return(t=this.feature)!=null?t.getIconUrl(e):void 0},t.prototype.getGeoJson=function(){return{type:this.getGeometryType(),coordinates:this.getCoordinates()}},t}(),r=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.geometryType=n,t.prototype.getOverlayOptions=function(e){return{}},t.prototype.initOverlay=function(e){return this.options=e!=null?e:{},!0},t.prototype.getCoordinates=function(){return[]},t.prototype.setEditable=function(e){return!0},t.prototype.getGeoJson=function(){return null},t}(i),v=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.geometryType=h,n.prototype.getOverlayOptions=function(e){var t,n,r;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:this.getDefaultZIndex(),icon:(r=e.icon)!=null?r:this.getIconUrl(e.zoom)}},n.prototype.initOverlay=function(t){return this.setOverlay(new e.Marker(this.getOverlayOptions(t)))},n.prototype.initEvents=function(e){var t,r=this;return e==null&&(e=this.overlay),n.__super__.initEvents.call(this,e),t=["animation_changed","clickable_changed","cursor_changed","drag","dragend","daggable_changed","dragstart","flat_changed","icon_changed","position_changed","shadow_changed","shape_changed","title_changed","visible_changed","zindex_changed"],t.forEach(function(t){return komoo.event.addListener(e,t,function(e,n){return komoo.event.trigger(r,t,e,n)})})},n.prototype.getCoordinates=function(){return this.getArrayFromLatLng(this.overlay.getPosition())},n.prototype.setCoordinates=function(e){return this.bounds=null,this.overlay.setPosition(this.getLatLngFromArray(e)),n.__super__.setCoordinates.call(this,e)},n.prototype.setEditable=function(e){return this.overlay.setDraggable(e)},n.prototype.getPosition=function(){return this.overlay.getPosition()},n.prototype.setPosition=function(e){return this.overlay.setPosition(e instanceof Array?this.getLatLngFromArray(e):e)},n.prototype.addMarker=function(e){return this.setOverlay(e)},n}(i),c=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.geometryType=a,n.prototype.getOverlayOptions=function(e){var t,n,r;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:this.getDefaultZIndex(),icon:(r=e.icon)!=null?r:this.getIconUrl(e.zoom)}},n.prototype.initOverlay=function(e){return this.setOverlay(new MultiMarker(this.getOverlayOptions(e)))},n.prototype.getPoints=function(){return this.overlay.getMarkers().getArray()},n.prototype.setPoints=function(e){return this.overlay.addMarkers(e)},n.prototype.guaranteePoints=function(t){var n,r,i,s,o,u;r=this.overlay.getMarkers();if(r.length>=t){o=[];for(n=0,i=r.length-t-1;0<=i?n<=i:n>=i;0<=i?n++:n--)o.push(r.pop());return o}u=[];for(n=0,s=t-r.length-1;0<=s?n<=s:n>=s;0<=s?n++:n--)u.push(this.overlay.addMarker(new e.Marker(this.options)));return u},n.prototype.getCoordinates=function(){var e,t,n,r,i;r=this.getPoints(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.getArrayFromLatLng(e.getPosition()));return i},n.prototype.setCoordinates=function(e){var t,r,i,s;e[0]instanceof Array||(e=[e]),this.guaranteePoints(e.length),this.bounds=null,s=this.getPoints();for(t=0,i=s.length;t<i;t++)r=s[t],r.setPosition(this.getLatLngFromArray(e[t]));return n.__super__.setCoordinates.call(this,e)},n.prototype.setEditable=function(e){return this.overlay.setDraggable(e)},n.prototype.getPositions=function(){var e,t,n,r,i;r=this.getPoints(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.getPosition());return i},n.prototype.setPositions=function(e){return this.overlay.setPositions(e)},n.prototype.getMarkers=function(){return this.overlay.getMarkers()},n.prototype.addMarkers=function(e){return this.overlay.addMarkers(e)},n.prototype.addMarker=function(e){return this.overlay.addMarker(e)},n}(i),g=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.geometryType=h,t.prototype.getGeoJson=function(){return{type:a,coordinates:this.getCoordinates()}},t}(c),o=function(t){function n(e){n.__super__.constructor.call(this,e),this.handleEvents()}return __extends(n,t),n.prototype.geometryType=s,n.prototype.getOverlayOptions=function(e){var t,n,r,i,s;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:this.getDefaultZIndex(),strokeColor:(r=e.strokeColor)!=null?r:this.getBorderColor(),strokOpacity:(i=e.strokeOpacity)!=null?i:this.getBorderOpacity(),strokeWeight:(s=e.strokeWeight)!=null?s:this.getBorderSize()}},n.prototype.initOverlay=function(t){return this.setOverlay(new e.Polyline(this.getOverlayOptions(t)))},n.prototype.handleEvents=function(){var e=this;return komoo.event.addListener(this,"mousemove",function(t){return e.setOptions({strokeWeight:e.getBorderSizeHover()})}),komoo.event.addListener(this,"mouseout",function(t){return e.setOptions({strokeWeight:e.getBorderSize()})})},n.prototype.getCoordinates=function(){var e,t,n,r,i;r=this.overlay.getPath().getArray(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.getArrayFromLatLng(e));return i},n.prototype.setCoordinates=function(e){var t;return this.overlay.setPath(function(){var n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.getLatLngFromArray(t));return i}.call(this))},n.prototype.setEditable=function(e){return this.overlay.setEditable(e)},n.prototype.getBorderColor=function(){var e;return((e=this.feature)!=null?e.getBorderColor():void 0)||y.BORDER_COLOR},n.prototype.getBorderOpacity=function(){var e;return((e=this.feature)!=null?e.getBorderOpacity():void 0)||y.BORDER_OPACITY},n.prototype.getBorderSize=function(){var e;return((e=this.feature)!=null?e.getBorderSize():void 0)||y.BORDER_SIZE},n.prototype.getBorderSizeHover=function(){var e;return((e=this.feature)!=null?e.getBorderSizeHover():void 0)||y.BORDER_SIZE_HOVER},n.prototype.getPath=function(){return this.overlay.getPath()},n.prototype.setPath=function(e){return this.overlay.setPath(e)},n}(i),l=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.geometryType=f,n.prototype.initOverlay=function(e){return this.setOverlay(new MultiPolyline(this.getOverlayOptions(e)))},n.prototype.guaranteeLines=function(t){var n,r,i,s,o,u;r=this.overlay.getPolylines();if(r.length>=t){o=[];for(n=0,i=r.length-t-1;0<=i?n<=i:n>=i;0<=i?n++:n--)o.push(r.pop());return o}u=[];for(n=0,s=t-r.length-1;0<=s?n<=s:n>=s;0<=s?n++:n--)u.push(this.overlay.addPolyline(new e.Polyline(this.options)));return u},n.prototype.getCoordinates=function(){var e,t,n,r,i;r=this.overlay.getPolylines().getArray(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.getArrayFromLatLngArray(e.getPath().getArray()));return i},n.prototype.setCoordinates=function(e){var t,n,r,i,s;e[0][0]instanceof Array||(e=[e]),this.guaranteeLines(e.length),this.bounds=null,i=this.getLines(),s=[];for(t=0,r=i.length;t<r;t++)n=i[t],s.push(n.setPath(this.getLatLngArrayFromArray(e[t])));return s},n.prototype.getBorderSize=function(){return n.__super__.getBorderSize.call(this)+1},n.prototype.getBorderSizeHover=function(){return n.__super__.getBorderSizeHover.call(this)+1},n.prototype.getPath=function(){return this.getPaths().getAt(0)},n.prototype.getPaths=function(){return this.overlay.getPaths()},n.prototype.setPaths=function(e){return this.overlay.setPaths(e)},n.prototype.getLines=function(){return this.overlay.getPolylines().getArray()},n.prototype.setLines=function(e){return this.overlay.addPolylines(e)},n.prototype.addPolyline=function(e,t){return this.overlay.addPolyline(e,t)},n.prototype.getPolylines=function(){return this.overlay.getPolylines()},n}(o),m=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.geometryType=p,n.prototype.getOverlayOptions=function(e){var t,n,r,i,s,o,u;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:this.getDefaultZIndex(),fillColor:(r=e.fillColor)!=null?r:this.getBackgroundColor(),fillOpacity:(i=e.fillOpacity)!=null?i:this.getBackgroundOpacity(),strokeColor:(s=e.strokeColor)!=null?s:this.getBorderColor(),strokeOpacity:(o=e.strokeOpacity)!=null?o:this.getBorderOpacity(),strokeWeight:(u=e.strokeWeight)!=null?u:this.getBorderSize()}},n.prototype.initOverlay=function(t){return this.setOverlay(new e.Polygon(this.getOverlayOptions(t)))},n.prototype.getBackgroundColor=function(){var e;return((e=this.feature)!=null?e.getBackgroundColor():void 0)||y.BACKGROUND_COLOR},n.prototype.getBackgroundOpacity=function(){var e;return((e=this.feature)!=null?e.getBackgroundOpacity():void 0)||y.BACKGROUND_OPACITY},n.prototype.getCoordinates=function(){var e,t,n,r,i,s;e=[],s=this.overlay.getPaths().getArray();for(r=0,i=s.length;r<i;r++)t=s[r],n=this.getArrayFromLatLngArray(t.getArray()),n.length&&n.push(n[0]),n.length>0&&e.push(n);return e},n.prototype.setCoordinates=function(e){var t,n,r,i,s;n=[],this.bounds=null;for(i=0,s=e.length;i<s;i++)r=e[i],t=this.getLatLngArrayFromArray(r),t.pop(),n.push(t);return this.setPaths(n)},n.prototype.getPath=function(){return this.getPaths().getAt(0)},n.prototype.getPaths=function(){return this.overlay.getPaths()},n.prototype.setPaths=function(e){return this.overlay.setPaths(e)},n}(o),window.komoo.geometries={types:{EMPTY:n,POINT:h,MULTIPOINT:a,POLYGON:p,POLYLINE:d,LINESTRING:s,MULTIPOLYLINE:f,MULTILINESTRING:u},MultiMarker:MultiMarker,Geometry:i,Empty:r,Point:g,MultiPoint:c,LineString:o,MultiLineString:l,Polygon:m,defaults:y,makeGeometry:function(e,t){var n,i,s,o;s={feature:t};if(e.geometry==null)return new r(s);o=e.geometry.type,n=e.geometry.coordinates;if(o==="Point")i=new g(s);else if(o==="MultiPoint"||o==="marker")i=new c(s);else if(o==="LineString"||o==="polyline")n&&(n=[n]),i=new l(s);else if(o==="MultiLineString")i=new l(s);else if(o==="Polygon"||o==="polygon")i=new m(s);return n&&i!=null&&i.setCoordinates(n),i}},window.komoo.geometries}),define("map/utils",["googlemaps"],function(e){return window.komoo||(komoo={}),komoo.utils={},komoo.utils.createCookie=function(e,t,n){var r;if(n){var i=new Date;i.setTime(i.getTime()+n*24*60*60*1e3),r="; expires="+i.toGMTString()}else r="";document.cookie=e+"="+t+r+"; path=/"},komoo.utils.readCookie=function(e){var t=e+"=",n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)===0)return i.substring(t.length,i.length)}return null},komoo.utils.eraseCookie=function(e){createCookie(e,"",-1)},komoo.utils.isPointInside=function(e,t){if(!t)return!1;var n=!1,r=t.getLength();for(var i=-1,s=r-1;++i<r;s=i)(t.getAt(i).lng()<=e.lng()&&e.lng()<t.getAt(s).lng()||t.getAt(s).lng()<=e.lng()&&e.lng()<t.getAt(i).lng())&&e.lat()<(t.getAt(s).lat()-t.getAt(i).lat())*(e.lng()-t.getAt(i).lng())/(t.getAt(s).lng()-t.getAt(i).lng())+t.getAt(i).lat()&&(n=!n);return n},komoo.utils.latLngToPoint=function(t,n,r){t.googleMap&&(t=t.googleMap);var i=r||t.getZoom(),s=t.getProjection().fromLatLngToPoint(n),o=Math.pow(2,i),u=new e.Point(s.x*o,s.y*o);return u},komoo.utils.pointToLatLng=function(t,n,r){t.googleMap&&(t=t.googleMap);var i=r||t.getZoom(),s=Math.pow(2,i),o=new e.Point(n.x/s,n.y/s),u=t.getProjection().fromPointToLatLng(o);return u},komoo.utils}),define("text!templates/map/_searchbox.html",[],function(){return'<form class\'search-form\' action="#">\n  <select name="location-type" class="location-type">\n    <option value="address"><%= gettext(\'Address\') %></option>\n    <option value="latLng"><%= gettext(\'Coordinate\') %></option>\n  </select>\n  <div class="address-container input-container">\n    <input type="text" name="address" value="" placeholder="<%= gettext(\'Address\') %>" class="address" />\n  </div>\n  <div class="latLng-container input-container" style="display: none;">\n    <input type="text" name="lat" value="" placeholder="<%= gettext(\'Latitude\') %>"  class="lat" />\n    <input type="text" name="lng" value="" placeholder="<%= gettext(\'Longitude\') %>" class="lng" />\n  </div>\n  <input type="submit" class="btn search" value="<%= gettext(\'Go\') %>" />\n  </form>\n'}),define("map/views",["backbone","underscore","text!templates/map/_searchbox.html"],function(e,t,n){var r;return r=e.View.extend({events:{"click .search":"onSearchBtnClick","change .location-type":"onTypeChange"},initialize:function(){return this.template=t.template(n)},render:function(){var e;return e=this.template(),this.$el.html(e),this},onTypeChange:function(){var e;return e=this.$(".location-type").val(),e==="address"?(this.$(".latLng-container").hide(),this.$(".address-container").show()):(this.$(".address-container").hide(),this.$(".latLng-container").show())},onSearchBtnClick:function(){var e,t;return t=this.$(".location-type").val(),e=t==="address"?this.$(".address").val():[parseFloat(this.$(".lat").val().replace(",",".")),parseFloat(this.$(".lng").val().replace(",","."))],this.search(t,e),!1},search:function(e,t){return e==null&&(e="address"),this.trigger("search",{type:e,position:t}),this}}),{SearchBoxView:r}});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("map/controls",["googlemaps","map/component","map/common","map/geometries","map/utils","infobox","markerclusterer"],function(e,t,n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,J,K,Q;return window.komoo==null&&(window.komoo={}),(Q=window.komoo).event==null&&(Q.event=e.event),J=gettext("Next Step"),z=gettext("Cancel"),W=gettext("Close"),U=gettext("Add shape"),q=gettext("Add line"),R=gettext("Add point"),K=gettext("Sum"),X=gettext("Cut out"),V=gettext("Loading..."),y=n.geometries.types.EMPTY,M=n.geometries.types.POINT,C=n.geometries.types.MULTIPOINT,_=n.geometries.types.POLYGON,D=n.geometries.types.LINESTRING,S=n.geometries.types.LINESTRING,k=n.geometries.types.MULTILINESTRING,N=n.geometries.types.MULTILINESTRING,A={},A[M]=e.drawing.OverlayType.MARKER,A[C]=e.drawing.OverlayType.MARKER,A[S]=e.drawing.OverlayType.POLYLINE,A[N]=e.drawing.OverlayType.POLYLINE,A[_]=e.drawing.OverlayType.POLYGON,g="edit",d="delete",L="new",u="add",h="cutout",O="perimeter_selection",c=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.position=e.ControlPosition.RIGHT_BOTTOM,n.prototype.init=function(){return n.__super__.init.call(this),this.box=$("<div>"),this.id!=null&&this.box.attr("id",this.id),this["class"]!=null&&this.box.addClass(this["class"]),this.map.addControl(this.position,this.box.get(0)),typeof this.handleMapEvents=="function"?this.handleMapEvents():void 0},n}(t),B=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.position=e.ControlPosition.TOP_RIGHT,n.prototype.id="map-searchbox",n.prototype.init=function(){var e=this;return n.__super__.init.call(this),require(["map/views"],function(t){return e.view=new t.SearchBoxView,e.box.append(e.view.render().el),e.handleViewEvents()})},n.prototype.handleViewEvents=function(){var e=this;return this.view.on("search",function(t){var n,r;return r=t.type,n=t.position,e.map.publish("goto",n,!1)})},n}(c),F=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.id="map-supporters",t.prototype.init=function(){return t.__super__.init.call(this),this.box.append($("#map-supporters-content").show())},t}(c),x=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.id="map-license",n.prototype.position=e.ControlPosition.BOTTOM_LEFT,n.prototype.init=function(){return n.__super__.init.call(this),this.box.html('Este conteúdo é disponibilizado nos termos da licença <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.pt_BR">Creative Commons - Atribuição - Partilha nos Mesmos Termos 3.0 Não Adaptada</a>; pode estar sujeito a condições adicionais. Para mais detalhes, consulte as Condições de Uso.')},n}(c),m=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.enabled=!0,n.prototype.defaultDrawingManagerOptions={drawingControl:!1,drawingMode:null},n.prototype.componentOriginalStatus={},n.prototype.init=function(e){var t;this.options=e!=null?e:{},(t=this.options).drawingManagerOptions==null&&(t.drawingManagerOptions=this.defaultDrawingManagerOptions);if(this.options.map)return this.setMap(this.options.map)},n.prototype.initManager=function(t){return t==null&&(t=this.defaultDrawingManagerOptions),this.manager=new e.drawing.DrawingManager(t),this.handleManagerEvents()},n.prototype.setMap=function(e){return this.map=e,this.options.drawingManagerOptions.map=this.map.googleMap,this.initManager(this.options.drawingManagerOptions),this.handleMapEvents()},n.prototype.enable=function(){return this.enabled=!0},n.prototype.disable=function(){return this.enabled=!1},n.prototype.setMode=function(e){var t;this.mode=e,this.manager.setDrawingMode((t=this.mode)===u||t===L||this.mode===h&&this.feature.getGeometryType()===_?A[this.feature.getGeometryType()]:null);if(this.mode===h&&this.feature.getGeometryType()!==_)return this.mode=g},n.prototype.handleMapEvents=function(){var e=this;return this.map.subscribe("draw_feature",function(t,n){return e.drawFeature(n)}),this.map.subscribe("edit_feature",function(t){return e.editFeature(t)}),this.map.subscribe("drawing_finished",function(t){return e.feature.setEditable(!1),e.feature.updateIcon(),e.setFeature(null),e.setMode(null)}),this.map.subscribe("finish_drawing",function(){return e.map.publish("drawing_finished",e.feature,!0)}),this.map.subscribe("cancel_drawing",function(){return e.map.publish("drawing_finished",e.feature,!1)}),this.map.subscribe("mode_changed",function(t){return e.setMode(t)}),this.map.subscribe("feature_rightclick",function(e,t){var n,r,i;if(e.vertex==null)return;n=t.getGeometry().getOverlay(),i=typeof n.getPaths=="function"?n.getPaths():void 0,r=i!=null?i.getAt(e.path):void 0,r!=null&&r.removeAt(e.vertex);if((r!=null?r.getLength():void 0)===1)return i.removeAt(e.path)})},n.prototype.handleManagerEvents=function(){var t=this;return komoo.event.addListener(this.manager,"overlaycomplete",function(n){var r,i,s,o,a,f,l,c,p,d,v,m,y;s=(l=n.overlay)!=null?typeof l.getPath=="function"?l.getPath():void 0:void 0;if(s&&((c=t.mode)===u||c===L||c===h)&&((p=n.overlay)!=null?p.getPaths:void 0)){o=t.feature.getGeometry().getPaths(),t.mode===L&&o.clear();if((o!=null?o.length:void 0)>0){a=e.geometry.spherical.computeSignedArea(s),f=e.geometry.spherical.computeSignedArea(o.getAt(0)),r=a/Math.abs(a),i=f/Math.abs(f);if(r===i&&t.mode===h||r!==i&&((d=t.mode)===u||d===L))s=new e.MVCArray(s.getArray().reverse())}o.push(s),t.feature.getGeometry().setPaths(o),n.overlay.setMap(null)}else(v=t.mode)!==u&&v!==L||!n.overlay.getPosition?((m=t.mode)===u||m===L)&&n.overlay.getPath&&t.feature.getGeometry().addPolyline(n.overlay,!0):(t.feature.getGeometry().addMarker(n.overlay),t.feature.updateIcon(100));return t.map.setMode(g),(y=t.feature)!=null?y.setEditable(!0):void 0})},n.prototype.setFeature=function(e){var t=this;this.feature=e,this.featureClickListener!=null&&komoo.event.removeListener(this.featureClickListener);if(this.feature==null)return;return this.feature.setMap(this.map,{geometry:!0}),this.featureClickListener=komoo.event.addListener(this.feature,"click",function(e,n){var r,s,o,u,a,f;if(t.mode===d)return t.feature.getGeometryType()===_?(u=t.feature.getGeometry().getPaths(),u.forEach(function(t,n){if(i.isPointInside(e.latLng,t))return u.removeAt(n)})):n&&t.feature.getGeometryType()===C?(o=t.feature.getGeometry().getMarkers(),r=$.inArray(n,o.getArray()),r>-1&&(s=o.removeAt(r),s.setMap(null))):n&&t.feature.getGeometryType()===N&&(f=t.feature.getGeometry().getPolylines(),r=$.inArray(n,f.getArray()),r>-1&&(a=f.removeAt(r),a.setMap(null))),t.map.setMode(g)})},n.prototype.editFeature=function(e){var t;if(this.enabled===!1)return;this.setFeature(e);if(this.feature.getGeometryType()==="Empty"){this.map.publish("select_new_geometry",this.feature);return}return this.feature.setEditable(!0),t={},t[""+A[this.feature.getGeometryType()]+"Options"]=this.feature.getGeometry().getOverlayOptions({strokeWeight:2.5,zoom:100}),this.manager.setOptions(t),this.map.setMode(g),this.map.publish("drawing_started",this.feature)},n.prototype.drawFeature=function(e){this.feature=e;if(this.enabled===!1)return;return this.editFeature(this.feature),this.map.setMode(L)},n}(t),p=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.id="map-drawing-box",n.prototype["class"]="map-panel",n.prototype.position=e.ControlPosition.TOP_LEFT,n.prototype.init=function(e){var t,r;return e==null&&(e={title:""}),n.__super__.init.call(this),t=(r=e.title)!=null?r:"",this.box.html('<div id="drawing-control">\n  <div class="map-panel-title" id="drawing-control-title">'+t+'</div>\n  <div class="content" id="drawing-control-content"></div>\n  <div class="map-panel-buttons">\n    <div class="map-button" id="drawing-control-cancel">'+W+"</div>\n  </div>\n</div>"),this.box.show(),this.handleButtonEvents()},n.prototype.setTitle=function(e){return e==null&&(e=""),this.box.find("#drawing-control-title").text(e)},n.prototype.handleButtonEvents=function(){var e=this;return $("#drawing-control-cancel",this.box).click(function(){return e.map.publish("close_clicked")})},n}(c),w=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.id="map-drawing-box",n.prototype["class"]="map-panel",n.prototype.position=e.ControlPosition.TOP_LEFT,n.prototype.init=function(){return n.__super__.init.call(this),this.box.hide(),this.box.html('<div id="geometry-selector">\n  <div class="map-panel-title" id="drawing-control-title"></div>\n  <ul class="content" id="drawing-control-content">\n    <li class="polygon btn" data-geometry-type="Polygon">\n      <i class="icon-polygon middle"></i><span class="middle">Adicionar área</span>\n    </li>\n    <li class="linestring btn" data-geometry-type="LineString">\n      <i class="icon-linestring middle"></i><span class="middle">Adicionar linha</span>\n    </li>\n    <li class="point btn" data-geometry-type="Point">\n      <i class="icon-point middle"></i><span class="middle">Adicionar ponto</span>\n    </li>\n  </ul>\n  <div class="map-panel-buttons">\n    <div class="map-button" id="drawing-control-cancel">'+z+"</div>\n  </div>\n</div>"),this.handleBoxEvents()},n.prototype.handleMapEvents=function(){var e=this;return this.map.subscribe("select_new_geometry",function(t){return e.open(t)})},n.prototype.handleBoxEvents=function(){var e=this;return this.box.find("li").each(function(t,n){var r,i;return r=$(n),i=r.attr("data-geometry-type"),r.click(function(){return e.close(),e.map.editFeature(e.feature,i)})})},n.prototype.handleButtonEvents=function(){var e=this;return $("#drawing-control-cancel",this.box).click(function(){return e.map.publish("cancel_drawing")})},n.prototype.showContent=function(){var e,t,n,r,i,s;this.box.find("li").hide(),i=(r=this.feature.getFeatureType())!=null?r.geometryTypes:void 0,s=[];for(t=0,n=i.length;t<n;t++)e=i[t],s.push(this.box.find("li."+e.toLowerCase()).show());return s},n.prototype.open=function(e){return this.feature=e,this.showContent(),$("#drawing-control-title",this.box).html("Selecione o tipo de objeto"),this.handleButtonEvents(),this.box.show()},n.prototype.close=function(){return this.box.hide()},n}(c),v=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.id="map-drawing-box",n.prototype["class"]="map-panel",n.prototype.position=e.ControlPosition.TOP_LEFT,n.prototype.init=function(){return n.__super__.init.call(this),this.box.hide(),this.box.html('<div id="drawing-control">\n  <div class="map-panel-title" id="drawing-control-title"></div>\n  <div class="content" id="drawing-control-content"></div>\n  <div class="map-panel-buttons">\n    <div class="map-button" id="drawing-control-finish">'+J+'</div>\n    <div class="map-button" id="drawing-control-cancel">'+z+"</div>\n  </div>\n</div>"),this.handleBoxEvents()},n.prototype.handleMapEvents=function(){var e=this;return this.map.subscribe("drawing_started",function(t){return e.open(t)}),this.map.subscribe("drawing_finished",function(t){return e.close()}),this.map.subscribe("mode_changed",function(t){return e.setMode(t)})},n.prototype.handleBoxEvents=function(){var e=this;return $("#drawing-control-finish",this.box).click(function(){if($("#drawing-control-finish",e.box).hasClass("disabled"))return;return e.map.publish("finish_drawing")}),$("#drawing-control-cancel",this.box).click(function(){return e.map.publish("cancel_drawing")})},n.prototype.handleButtonEvents=function(){var e=this;return $("#drawing-control-add",this.box).click(function(){return e.map.setMode(e.mode!==u?u:g)}),$("#drawing-control-cutout",this.box).click(function(){return e.map.setMode(e.mode!==h?h:g)}),$("#drawing-control-delete",this.box).click(function(){return e.map.setMode(e.mode!==d?d:g)})},n.prototype.setMode=function(e){var t;return this.mode=e,this.mode===L?($("#drawing-control-content",this.box).hide(),$("#drawing-control-finish",this.box).addClass("disabled")):($("#drawing-control-content",this.box).show(),$("#drawing-control-finish",this.box).removeClass("disabled")),$(".map-button.active",this.box).removeClass("active"),$("#drawing-control-"+((t=this.mode)!=null?t.toLowerCase():void 0),this.box).addClass("active")},n.prototype.getTitle=function(){var e,t,n,r;if(this.feature.getGeometryType()===_)e="polygon",t=U;else if((n=this.feature.getGeometryType())===S||n===N)e="linestring",t=q;else if((r=this.feature.getGeometryType())===M||r===C)e="point",t=R;return'<i class="icon-'+e+' middle"></i><span class="middle">'+t+"</span>"},n.prototype.getContent=function(){var e,t,n,r;return e=$('<div class="map-button" id="drawing-control-add"><i class="icon-komoo-plus middle"></i><span class="middle">'+K+"</span></div>"),n=$('<div class="map-button" id="drawing-control-cutout"><i class="icon-komoo-minus middle"></i><span class="middle">'+X+"</span></div>"),r=$('<div class="map-button" id="drawing-control-delete"><i class="icon-komoo-trash middle"></i></div>'),t=$("<div>").addClass(this.feature.getGeometryType().toLowerCase()),this.feature.getGeometryType()!==M&&t.append(e),this.feature.getGeometryType()===_&&t.append(n),this.feature.getGeometryType()!==M&&t.append(r),t},n.prototype.open=function(e){return this.feature=e,$("#drawing-control-title",this.box).html(this.getTitle()),$("#drawing-control-content",this.box).html(this.getContent()),this.handleButtonEvents(),this.box.show()},n.prototype.close=function(){return this.box.hide()},n}(c),P=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.enabled=!0,n.prototype.init=function(){var t=this;return n.__super__.init.call(this),this.circle=new e.Circle({visible:!0,radius:100,fillColor:"white",fillOpacity:0,strokeColor:"#ffbda8",zIndex:-1}),this.marker=new e.Marker({icon:"/static/img/marker.png"}),komoo.event.addListener(this.circle,"click",function(e){if(t.map.mode===O)return t.selected(e.latLng)})},n.prototype.select=function(e,t){this.radius=e,this.callback=t;if(!this.enabled)return;return this.origMode=this.map.mode,this.map.disableComponents("infoWindow"),this.map.setMode(O)},n.prototype.selected=function(e){return typeof this.radius=="number"&&this.circle.setRadius(this.radius),typeof this.callback=="function"&&this.callback(e,this.circle),this.circle.setCenter(e),this.circle.setMap(this.map.googleMap),this.marker.setPosition(e),this.marker.setMap(this.map.googleMap),this.map.publish("perimeter_selected",e,this.circle),this.map.setMode(this.origMode),this.map.enableComponents("infoWindow")},n.prototype.handleMapEvents=function(){var e,t,n,r,i,s=this;this.map.subscribe("select_perimeter",function(e,t){return s.select(e,t)}),r=["click","feature_click"],i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.map.subscribe(e,function(e){if(s.map.mode===O)return s.selected(e.latLng)}));return i},n.prototype.setMap=function(e){return this.map=e,this.handleMapEvents()},n.prototype.enable=function(){return this.enabled=!0},n.prototype.disable=function(){return this.hide(),this.enabled=!1},n}(t),l=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.defaultWidth="300px",n.prototype.enabled=!0,n.prototype.init=function(e){return this.options=e!=null?e:{},n.__super__.init.call(this),this.width=this.options.width||this.defaultWidth,this.createInfoBox(this.options),this.options.map&&this.setMap(this.options.map),this.customize()},n.prototype.createInfoBox=function(t){return this.setInfoBox(new s({pixelOffset:new e.Size(0,-20),enableEventPropagation:!0,closeBoxMargin:"10px",disableAutoPan:!0,boxStyle:{cursor:"pointer",background:"url(/static/img/infowindow-arrow.png) no-repeat 0 10px",width:this.width}}))},n.prototype.handleMapEvents=function(){var e=this;return this.map.subscribe("drawing_started",function(t){return e.disable()}),this.map.subscribe("drawing_finished",function(t){return e.enable()})},n.prototype.setInfoBox=function(e){this.infoBox=e},n.prototype.setMap=function(e){return this.map=e,this.handleMapEvents()},n.prototype.enable=function(){return this.enabled=!0},n.prototype.disable=function(){return this.close(!1),this.enabled=!1},n.prototype.open=function(e){var t,n,r,s,o,u,a,f;this.options=e!=null?e:{};if(!this.enabled)return;return this.setContent(this.options.content||(this.options.features?this.createClusterContent(this.options):this.createFeatureContent(this.options))),this.feature=(o=this.options.feature)!=null?o:(u=this.options.features)!=null?u.getAt(0):void 0,s=(a=this.options.position)!=null?a:this.feature.getCenter(),s instanceof Array&&(t=new komoo.geometries.Empty,s=t.getLatLngFromArray(s)),r=i.latLngToPoint(this.map,s),r.x+=5,n=i.pointToLatLng(this.map,r),this.infoBox.setPosition(n),this.infoBox.open((f=this.map.googleMap)!=null?f:this.map)},n.prototype.setContent=function(e){return e==null&&(e={title:"",body:""}),typeof e=="string"&&(e={title:"",url:"",body:e}),this.title.html(e.url?'<a href="'+e.url+"'\">"+e.title+"</a>":e.title),this.body.html(e.body)},n.prototype.close=function(){var e;return this.isMouseover=!1,this.infoBox.close(),((e=this.feature)!=null?e.isHighlighted():void 0)&&this.feature.setHighlight(!1),this.feature=null},n.prototype.customize=function(){var t=this;return e.event.addDomListener(this.infoBox,"domready",function(n){var r;return r=t.infoBox.div_,e.event.addDomListener(r,"click",function(e){return e.cancelBubble=!0,typeof e.stopPropagation=="function"?e.stopPropagation():void 0}),e.event.addDomListener(r,"mouseout",function(e){return t.isMouseover=!1}),komoo.event.trigger(t,"domready")}),this.initDomElements()},n.prototype.initDomElements=function(){var e=this;return this.title=$("<div>"),this.body=$("<div>"),this.content=$("<div>").addClass("map-infowindow-content"),this.content.append(this.title),this.content.append(this.body),this.content.css({background:"white",padding:"10px",margin:"0 0 0 15px"}),this.content.hover(function(t){return e.isMouseover=!0},function(t){return e.isMouseover=!1}),this.infoBox.setContent(this.content.get(0))},n.prototype.createClusterContent=function(e){var t,n,r,i,s;return e==null&&(e={}),r=e.features||[],i=ngettext("%s Community","%s Communities",r.length),s="<strong>"+interpolate(i,[r.length])+"</strong>",t=function(){var e,t,i,s;i=r.slice(0,11),s=[];for(e=0,t=i.length;e<t;e++)n=i[e],s.push("<li>"+n.getProperty("name")+"</li>");return s}(),t="<ul>"+t.join("")+"</ul>",{title:s,url:"",body:t}},n.prototype.createFeatureContent=function(e){var t,n;return e==null&&(e={}),n="",t=e.feature,t&&(n=t.getProperty(!1)?t.getProperty("organization_name")+" - "+t.getProperty("name"):t.getProperty("name")),{title:n,url:"",body:""}},n}(t),a=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.createFeatureContent=function(e){var n,r,i=this;e==null&&(e={}),n=e.feature;if(!n)return;return n[this.contentViewName]?n[this.contentViewName]:n.getProperty("id")==null?t.__super__.createFeatureContent.call(this,e):(r=dutils.urls.resolve(this.contentViewName,{zoom:this.map.getZoom(),app_label:n.featureType.appLabel,model_name:n.featureType.modelName,obj_id:n.getProperty("id")}),$.get(r,function(e){return n[i.contentViewName]=e,i.setContent(e)}),V)},t}(l),E=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.defaultWidth="350px",n.prototype.contentViewName="info_window",n.prototype.open=function(e){var t,r;return(t=this.feature)!=null&&(t.displayTooltip=!0),n.__super__.open.call(this,e),(r=this.feature)!=null?r.displayTooltip=!1:void 0},n.prototype.close=function(e){var t,r;return e==null&&(e=!0),(t=this.feature)!=null&&t.setHighlight(!1),(r=this.feature)!=null&&(r.displayTooltip=!0),e&&this.map.enableComponents("tooltip"),n.__super__.close.call(this)},n.prototype.customize=function(){var t=this;return n.__super__.customize.call(this),e.event.addDomListener(this.infoBox,"domready",function(n){var r,i;return i=t.content.get(0),r=t.infoBox.div_.firstChild,e.event.addDomListener(i,"mousemove",function(e){return t.map.disableComponents("tooltip")}),e.event.addDomListener(i,"mouseout",function(e){r=t.infoBox.div_.firstChild;if(e.toElement!==r)return t.map.enableComponents("tooltip")}),e.event.addDomListener(r,"click",function(e){return t.close()})})},n.prototype.handleMapEvents=function(){var e=this;return n.__super__.handleMapEvents.call(this),this.map.subscribe("feature_click",function(t,n){return setTimeout(function(){return e.open({feature:n,position:t.latLng})},200)}),this.map.subscribe("feature_highlight_changed",function(t,n){if(n.isHighlighted())return e.open({feature:n})})},n}(a),I=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.contentViewName="tooltip",n.prototype.close=function(){return clearTimeout(this.timer),n.__super__.close.call(this)},n.prototype.customize=function(){var t=this;return n.__super__.customize.call(this),e.event.addDomListener(this.infoBox,"domready",function(n){var r,i;return i=t.infoBox.div_,e.event.addDomListener(i,"click",function(e){return e.latLng=t.infoBox.getPosition(),t.map.publish("feature_click",e,t.feature)}),r=i.firstChild,$(r).hide()})},n.prototype.handleMapEvents=function(){var e=this;return n.__super__.handleMapEvents.call(this),this.map.subscribe("feature_mousemove",function(t,n){var r;clearTimeout(e.timer);if(n===e.feature||!n.displayTooltip)return;return r=n.getType()==="Community"?400:10,e.timer=setTimeout(function(){if(!n.displayTooltip)return;return e.open({feature:n,position:t.latLng})},r)}),this.map.subscribe("feature_mouseout",function(t,n){return e.close()}),this.map.subscribe("feature_click",function(t,n){return e.close()}),this.map.subscribe("cluster_mouseover",function(t,n){var r;if((r=t.getAt(0))!=null?!r.displayTooltip:!void 0)return;return e.open({features:t,position:n})}),this.map.subscribe("cluster_mouseout",function(t,n){return e.close()}),this.map.subscribe("cluster_click",function(t,n){return e.close()})},n}(a),b=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.enabled=!0,t.prototype.maxZoom=9,t.prototype.gridSize=20,t.prototype.minSize=1,t.prototype.imagePath="/static/img/cluster/communities",t.prototype.imageSizes=[24,29,35,41,47],t.prototype.init=function(e){var t,n,r,i,s;this.options=e!=null?e:{},(t=this.options).gridSize==null&&(t.gridSize=this.gridSize),(n=this.options).maxZoom==null&&(n.maxZoom=this.maxZoom),(r=this.options).minimumClusterSize==null&&(r.minimumClusterSize=this.minSize),(i=this.options).imagePath==null&&(i.imagePath=this.imagePath),(s=this.options).imageSizes==null&&(s.imageSizes=this.imageSizes),this.featureType=this.options.featureType,this.features=[];if(this.options.map)return this.setMap(this.options.map)},t.prototype.initMarkerClusterer=function(e){var t,n;return e==null&&(e={}),t=((n=this.map)!=null?n.googleMap:void 0)||this.map,this.clusterer=new o(t,[],e)},t.prototype.initEvents=function(e){var t,n=this;e==null&&(e=this.clusterer);if(!e)return;return t=["clusteringbegin","clusteringend"],t.forEach(function(t){return komoo.event.addListener(e,t,function(e){return komoo.event.trigger(n,t,n)})}),t=["click","mouseout","mouseover"],t.forEach(function(t){return komoo.event.addListener(e,t,function(e){var r,i;return r=komoo.collections.makeFeatureCollection({features:function(){var t,n,r,s;r=e.getMarkers(),s=[];for(t=0,n=r.length;t<n;t++)i=r[t],s.push(i.feature);return s}()}),komoo.event.trigger(n,t,r,e.getCenter()),n.map.publish("cluster_"+t,r,e.getCenter())})})},t.prototype.setMap=function(e){return this.map=e,this.initMarkerClusterer(this.options),this.initEvents(),this.addFeatures(this.map.getFeatures()),this.handleMapEvents()},t.prototype.handleMapEvents=function(){var e=this;return this.map.subscribe("feature_created",function(t){if(t.getType()===e.featureType)return e.push(t)})},t.prototype.updateLength=function(){return this.length=this.features.length},t.prototype.clear=function(){return this.features=[],this.clusterer.clearMarkers(),this.updateLength()},t.prototype.getAt=function(e){return this.features[e]},t.prototype.push=function(e){if(e.getMarker())return this.features.push(e),e.getMarker().setVisible(!1),this.clusterer.addMarker(e.getMarker().getOverlay().markers_.getAt(0)),this.updateLength()},t.prototype.pop=function(){var e;return e=this.features.pop(),this.clusterer.removeMarker(e.getMarker()),this.updateLength(),e},t.prototype.forEach=function(e,t){return this.features.forEach(e,t)},t.prototype.repaint=function(){return this.clusterer.repaint()},t.prototype.getAverageCenter=function(){return this.clusterer.getAverageCenter()},t.prototype.addFeatures=function(e){var t=this;return e!=null?e.forEach(function(e){return t.push(e)}):void 0},t}(t),T=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.enabled=!0,n.prototype.init=function(){return this.geocoder=new e.Geocoder,this.marker=new e.Marker({icon:"/static/img/marker.png"})},n.prototype.handleMapEvents=function(){var e=this;return this.map.subscribe("goto",function(t,n){return e.goTo(t,n)}),this.map.subscribe("goto_user_location",function(){return e.goToUserLocation()})},n.prototype.goTo=function(t,n){var r,i,s,o=this;return n==null&&(n=!1),s=function(e){if(e){o.map.googleMap.panTo(e);if(n)return o.marker.setPosition(e)}},typeof t=="string"?(i={address:t,region:this.region},this.geocoder.geocode(i,function(t,n){var r,i;if(n===e.GeocoderStatus.OK)return r=t[0],i=r.geometry.location,s(i)})):(r=t instanceof Array?t.length===2?new e.LatLng(t[0],t[1]):void 0:t,s(r))},n.prototype.goToUserLocation=function(){var t,n,r=this;t=google.loader.ClientLocation,t&&(n=new e.LatLng(t.latitude,t.longitude),this.map.googleMap.setCenter(n),typeof console!="undefined"&&console!==null&&console.log("Getting location from Google..."));if(navigator.geolocation)return navigator.geolocation.getCurrentPosition(function(t){return n=new e.LatLng(t.coords.latitude,t.coords.longitude),r.map.googleMap.setCenter(n),typeof console!="undefined"&&console!==null?console.log("Getting location from navigator.geolocation..."):void 0},function(){return typeof console!="undefined"&&console!==null?console.log("User denied access to navigator.geolocation..."):void 0})},n.prototype.setMap=function(e){return this.map=e,this.marker.setMap(this.map.googleMap),this.handleMapEvents()},n.prototype.enable=function(){return this.enabled=!0},n.prototype.disable=function(){return this.close(!1),this.enabled=!1},n}(t),H=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.handleMapEvents=function(){var e=this;return t.__super__.handleMapEvents.call(this),this.map.subscribe("save_location",function(t,n){return e.saveLocation(t,n)}),this.map.subscribe("goto_saved_location",function(){return e.goToSavedLocation()})},t.prototype.saveLocation=function(e,t){return e==null&&(e=this.map.googleMap.getCenter()),t==null&&(t=this.map.getZoom()),i.createCookie("lastLocation",e.toUrlValue(),90),i.createCookie("lastZoom",t,90)},t.prototype.goToSavedLocation=function(){var e,t;e=i.readCookie("lastLocation"),t=parseInt(i.readCookie("lastZoom"),10);if(e&&t)return typeof console!="undefined"&&console!==null&&console.log("Getting location from cookie..."),this.map.publish("set_location",e),this.map.publish("set_zoom",t)},t}(T),f=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.handleMapEvents=function(){var e=this;return t.__super__.handleMapEvents.call(this),this.map.subscribe("idle",function(){return e.saveLocation()})},t}(H),j=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.enabled=!0,n.prototype.init=function(){return typeof console!="undefined"&&console!==null&&console.log("Initializing StreetView support."),this.streetViewPanel=$("<div>").addClass("map-panel"),this.streetViewPanel.height("100%").width("50%"),this.streetViewPanel.hide(),this.createObject()},n.prototype.setMap=function(t){this.map=t,this.map.googleMap.controls[e.ControlPosition.TOP_LEFT].push(this.streetViewPanel.get(0));if(this.streetView!=null)return this.map.googleMap.setStreetView(this.streetView)},n.prototype.createObject=function(){var t,n,r=this;return t={enableCloseButton:!0,visible:!1},this.streetView=new e.StreetViewPanorama(this.streetViewPanel.get(0),t),(n=this.map)!=null&&n.googleMap.setStreetView(this.streetView),e.event.addListener(this.streetView,"visible_changed",function(){return r.streetView.getVisible()?r.streetViewPanel.show():r.streetViewPanel.hide()})},n}(t),window.komoo.controls={DrawingManager:m,DrawingControl:v,GeometrySelector:w,Balloon:l,AjaxBalloon:a,InfoWindow:E,Tooltip:I,FeatureClusterer:b,CloseBox:p,SupporterBox:F,LicenseBox:x,SearchBox:B,PerimeterSelector:P,Location:T,SaveLocation:H,AutosaveLocation:f,StreetView:j},window.komoo.controls});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("map/maptypes",["googlemaps","map/component"],function(e,t){var n,r;return window.komoo==null&&(window.komoo={}),(r=window.komoo).event==null&&(r.event=e.event),n=function(t){function n(){this.mapType=new e.StyledMapType([{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{lightness:70}]},{featureType:"transit",elementType:"all",stylers:[{lightness:50}]},{featureType:"water",elementType:"all",stylers:[{lightness:50}]},{featureType:"administrative",elementType:"labels",stylers:[{lightness:30}]}],{name:gettext("Clean")})}return __extends(n,t),n.prototype.id="clean",n.prototype.setMap=function(e){var t;return this.map=e,this.map.googleMap.mapTypes.set(this.id,this.mapType),t=this.map.googleMap.mapTypeControlOptions,t.mapTypeIds.push(this.id),this.map.googleMap.setOptions({mapTypeControlOptions:t}),this.map.googleMap.setMapTypeId(this.id)},n}(t),window.komoo.maptypes={CleanMapType:n},window.komoo.maptypes});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("map/providers",["googlemaps","map/component"],function(e,t){var n,r,i;return window.komoo==null&&(window.komoo={}),(i=window.komoo).event==null&&(i.event=e.event),r=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.name="Generic Provider",n.prototype.alt="Generic Data Provider",n.prototype.tileSize=new e.Size(256,256),n.prototype.maxZoom=32,n.prototype.enabled=!0,n.prototype.init=function(e){return this.options=e,this.addrLatLngCache={},this.fetchedTiles={}},n.prototype.setMap=function(e){return this.map=e,this.map.googleMap.overlayMapTypes.insertAt(0,this),typeof this.handleMapEvents=="function"?this.handleMapEvents():void 0},n.prototype.enable=function(){return this.enabled=!0},n.prototype.disable=function(){return this.enabled=!1},n.prototype.getAddrLatLng=function(t,n){var r,i,s,o,u,a,f;return r="x="+t.x+",y="+t.y+",z="+n,this.addrLatLngCache[r]?this.addrLatLngCache[r]:(s=1<<n,a=this.map.googleMap.getProjection(),o=new e.Point((t.x+1)*this.tileSize.width/s,t.y*this.tileSize.height/s),u=new e.Point(t.x*this.tileSize.width/s,(t.y+1)*this.tileSize.height/s),i=a.fromPointToLatLng(o),f=a.fromPointToLatLng(u),this.addrLatLngCache[r]="bounds="+i.toUrlValue()+","+f.toUrlValue()+"&zoom="+n)},n}(t),n=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.name="Feature Provider",t.prototype.alt="Feature Provider",t.prototype.fetchUrl="/get_geojson?",t.prototype.init=function(e){return t.__super__.init.call(this,e),this.keptFeatures=komoo.collections.makeFeatureCollection()},t.prototype.handleMapEvents=function(){var e=this;return this.map.subscribe("idle",function(){var t;if(e.enabled===!1)return;return t=e.map.googleMap.getBounds(),e.keptFeatures.forEach(function(e){if(!t.intersects(e.getBounds()))return e.setMap(null)}),e.keptFeatures.clear()})},t.prototype.releaseTile=function(e){var t,n=this;if(this.enabled===!1)return;if(this.fetchedTiles[e.addr])return t=this.map.getBounds(),this.fetchedTiles[e.addr].features.forEach(function(e){if(e.getBounds){if(!t.intersects(e.getBounds()))return e.setMap(null);if(!t.contains(e.getBounds().getNorthEast()||!t.contains(e.getBounds().getSouthWest())))return n.keptFeatures.push(e),e.setMap(n.map)}else if(e.getPosition&&!t.contains(e.getPosition()))return e.setMap(null)})},t.prototype.getTile=function(e,t,n){var r,i,s=this;return i=n.createElement("DIV"),r=this.getAddrLatLng(e,t),i.addr=r,this.enabled===!1?i:this.fetchedTiles[r]?(this.fetchedTiles[r].features.setMap(this.map),i):($.ajax({url:this.fetchUrl+r,dataType:"json",type:"GET",success:function(e){var t;return t=s.map.loadGeoJSON(JSON.parse(e),!1),s.fetchedTiles[r]={geojson:e,features:t},t.setMap(s.map)},error:function(e,t){var n,r;return typeof console!="undefined"&&console!==null&&console.error(t),r=$("#server-error"),r.parent().length===0&&(r=$("<div>").attr("id","server-error"),$("body").append(r)),n=$("<div>").html(e.responseText),r.append(n)}}),i)},t}(r),window.komoo.providers={GenericProvider:r,FeatureProvider:n,makeFeatureProvider:function(e){return new n(e)}},window.komoo.providers}),define("map/core",["jquery","underscore","backbone"],function(e,t,n){var r,i;return r=function(){function r(){this._components={},this._pubQueue=[],this._pubsub={},t.extend(this._pubsub,n.Events)}return r.prototype.loading=0,r.prototype.data={deferred:e.Deferred,when:e.when},r.prototype._getComponent=function(e,t){var n,r;n=(r=this._components[e])!=null?r:{};if(n[t]==null)throw new Error("Could not be found a component '"+e+"' with id '"+t+"'");return n[t]},r.prototype._removeComponent=function(e,t){var n;return(n=this._components[e])!=null?delete n[t]:void 0},r.prototype.load=function(e,t,n){var r,i,s,o,u,a=this;return u=t,s=e.split("::"),r=s[0],i=s[1],o=this.data.deferred(),require([r],function(r){var s,f;s=r[i];try{f=new s(a,t)}catch(l){throw l}return a.data.when(f.init(n)).done(function(){return a._components[e][u].instance=f,typeof console!="undefined"&&console!==null&&console.log("Component '"+e+"' initialized"),a.publish(""+i+":started",u),o.resolve(f)}).fail(function(){return typeof console!="undefined"&&console!==null&&console.warn("Could not initialize component '"+e+"'"),o.resolve(f)})},function(t){var n;if(t.requireType!=="timeout")throw n=t.requireModules&&t.requireModules[0],require.undef(n),t;return typeof console!="undefined"&&console!==null&&console.warn("Could not load module '"+t.requireModules+"'"),o.resolve()}),o.promise()},r.prototype.unload=function(e){},r.prototype.start=function(n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=this;i==null&&(i={}),t.isString(n)?o=[{component:n,el:r,opts:i}]:t.isArray(n)?o=n:o=[n];if(!t.isArray(o))throw new Error("componentList must be defined as an array");c=[];for(d=0,v=o.length;d<v;d++)l=o[d],s=l.component,r=l.el,i=l.opts,this.loading++,f=r,(p=this._components)[s]==null&&(p[s]={}),u=this._components[s],u[f]!=null&&typeof console!="undefined"&&console!==null&&console.error("Conflict: already exists one component '"+s+"' with id '"+f+"' "),this._components[s][f]={type:s,el:r,opts:i},a=this.data.deferred(),c.push(this.load(s,r,i));return h=this.data.when.apply(e,c),h.done(function(){return m.loading-=arguments.length,m._processPublishQueue()}),h},r.prototype.stop=function(n,r){var i,s,o,u,a,f,l,c,h;a=r,f=t.isArray(a)?a:[a],o=this.data.deferred(),l=f.length,u=0;for(c=0,h=f.length;c<h;c++)i=f[c],s=this._getComponent(n,i),s.instance.destroy().done(function(){e(s.el).children().remove(),this._removeComponent(n,i),u++;if(u===l)return o.resolve()});return o.promise()},r.prototype.publish=function(e){return this._addToPublishQueue.apply(this,arguments),this._processPublishQueue()},r.prototype.subscribe=function(e,t,n){return this._pubsub.on(e,t,n)},r.prototype._addToPublishQueue=function(e){return this._pubQueue.push(arguments)},r.prototype._processPublishQueue=function(){var e;if(this.loading>0)return!1;e=this._pubQueue.shift();if(e!=null)return this._pubsub.trigger.apply(this._pubsub,e),this._processPublishQueue()},r}(),i={Mediator:r},i});var __hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("map/collections",["googlemaps"],function(e){var t,n,r,i,s;return window.komoo==null&&(window.komoo={}),(s=window.komoo).event==null&&(s.event=e.event),r=function(){function e(e){this.options=e!=null?e:{},this.elements=[],this.length=0}return e.prototype.updateLength=function(){return this.length=this.elements.length},e.prototype.clear=function(){return this.elements=[],this.updateLength()},e.prototype.getAt=function(e){return this.elements[e]},e.prototype.push=function(e){return this.elements.push(e),this.updateLength()},e.prototype.pop=function(){var e;return e=this.elements.pop(),this.updateLength(),e},e.prototype.forEach=function(e,t){return this.elements.forEach(e,t)},e.prototype.getArray=function(){return this.elements},e.prototype.slice=function(e,t){return this.elements.slice(e,t)},e}(),t=function(t){function n(e){var t,r=this;e==null&&(e={}),n.__super__.constructor.call(this,e),e.map&&this.setMap(e.map),(t=e.features)!=null&&t.forEach(function(e){return r.push(e)})}return __extends(n,t),n.prototype.push=function(e){if(e==null)return;return n.__super__.push.call(this,e),e.setMap(this.map)},n.prototype.getBounds=function(){var t,n,r,i=this;return t=this.getAt(0),t&&t.getGeometryType()!=="Empty"&&(n=t.getGeometry(),r=n.getLatLngFromArray(n.getCenter()),this.bounds=new e.LatLngBounds(r,r),this.forEach(function(e){var t;return(t=i.bounds)!=null?t.union(e.getBounds()):void 0})),this.bounds},n.prototype.setMap=function(e,t){var n,r=this;return this.map=e,n=null,this.forEach(function(e){return t!=null&&(n={geometry:t!=null?t.geometry:void 0,point:t!=null?t.icon:void 0,icon:t!=null?t.icon:void 0}),e.getType()==="Community"&&n!=null&&(n.point=!1),e!=null?e.setMap(r.map,n):void 0}),this.handleMapEvents()},n.prototype.show=function(){return this.setMap(this.map,{geometry:!0}),this.setVisible(!0)},n.prototype.hide=function(){return this.setVisible(!1)},n.prototype.getGeoJson=function(e){var t;return e.geometryCollection==null&&(e.geometryCollection=!1),e.geometryCollection?(t={type:"GeometryCollection",geometries:[]},this.forEach(function(e){return t.geometries.push(e.getGeometryGeoJson())})):(t={type:"FeatureCollection",features:[]},this.forEach(function(e){return t.features.push(e.getGeoJson())})),t},n.prototype.removeAllFromMap=function(){return this.forEach(function(e){return e.removeFromMap()})},n.prototype.setVisible=function(e){return this.forEach(function(t){return t.setVisible(e)})},n.prototype.updateFeaturesVisibility=function(){return this.forEach(function(e){return e.seMap(e.getMap())})},n.prototype.handleMapEvents=function(){var e=this;return komoo.event.addListener(this.map,"zoom_changed",function(){})},n}(r),n=function(e){function n(e){e==null&&(e={}),n.__super__.constructor.call(this,e),this.featuresByType={}}return __extends(n,e),n.prototype.push=function(e){var r,i,s,o,u,a,f,l=this;return n.__super__.push.call(this,e),r=e.getType(),(i=this.featuresByType)[r]==null&&(i[r]={}),(s=this.featuresByType[r])["categories"]==null&&(s.categories={}),(o=this.featuresByType[r]["categories"])["all"]==null&&(o.all=new t({map:this.map})),(u=this.featuresByType[r]["categories"])["uncategorized"]==null&&(u.uncategorized=new t({map:this.map})),(f=e.getCategories())!=null&&f.forEach(function(n){var i,s;return(i=l.featuresByType[r]["categories"])[s=n.name]==null&&(i[s]=new t({map:l.map})),l.featuresByType[r].categories[n.name].push(e)}),(e.getCategories()==null||e.getCategories().length===0)&&this.featuresByType[r].categories.uncategorized.push(e),this.featuresByType[r].categories.all.push(e),(a=this.featuresByType[r])["ids"]==null&&(a.ids={}),this.featuresByType[r].ids[e.getProperty("id")]=e},n.prototype.pop=function(){return n.__super__.pop.call(this)},n.prototype.clear=function(){return this.featuresByType={},n.__super__.clear.call(this)},n.prototype.getByType=function(e,n,r){var i,s=this;return r==null&&(r=!1),this.featuresByType[e]?n?n.length===0?this.featuresByType[e].categories.uncategorized:(i=new t({map:this.map}),n.forEach(function(t){if(s.featuresByType[e].categories[t])return s.featuresByType[e].categories[t].forEach(function(e){if(!r||!e.getCategories()||e.getCategories().length===1)return i.push(e)})}),i):this.featuresByType[e].categories.all:!1},n.prototype.getById=function(e,t){var n;return(n=this.featuresByType[e])!=null?n.ids[t]:void 0},n.prototype.highlightFeature=function(e,t){var n,r;n=typeof e=="string"?this.getById(e,t):e;if(n.isHighlighted())return;return(r=this.highlighted)!=null&&r.setHighlight(!1),n.highlight(),this.highlighted=n},n}(t),i=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(t),window.komoo.collections={GenericCollection:r,FeatureCollection:t,FeatureCollectionPlus:n,makeFeatureCollection:function(e){return e==null&&(e={}),new t(e)},makeFeatureCollectionPlus:function(e){return e==null&&(e={}),new n(e)}},window.komoo.collections}),define("map/features",["googlemaps","map/geometries"],function(e,t){var n,r;return window.komoo==null&&(window.komoo={}),(r=window.komoo).event==null&&(r.event=e.event),n=function(){function e(e){var n;this.options=e!=null?e:{},n=this.options.geometry,this.setFeatureType(this.options.featureType),this.options.geojson&&(this.options.geojson.properties&&this.setProperties(this.options.geojson.properties),n==null&&(n=t.makeGeometry(this.options.geojson,this))),n!=null&&(this.setGeometry(n),this.createMarker())}return e.prototype.displayTooltip=!0,e.prototype.displayInfoWindow=!0,e.prototype.createMarker=function(){var e;return e=new t.Point({visible:!0,clickable:!0}),e.setCoordinates(this.getCenter()),this.setMarker(e)},e.prototype.initEvents=function(e){var t,n;return e==null&&(e=this.geometry),n=this,t=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick","drag","dragend","draggable_changed","dragstart","coordinates_changed"],t.forEach(function(t){return komoo.event.addListener(e,t,function(e,r){return komoo.event.trigger(n,t,e,r)})})},e.prototype.getGeometry=function(){return this.geometry},e.prototype.setGeometry=function(e){return this.geometry=e,this.geometry.feature=this,this.initEvents()},e.prototype.getGeometryType=function(){return this.geometry.getGeometryType()},e.prototype.getFeatureType=function(){return this.featureType},e.prototype.setFeatureType=function(e){this.featureType=e!=null?e:{minZoomPoint:0,maxZoomPoint:10,minZoomIcon:10,maxZoomIcon:100,minZoomGeometry:0,maxZoomGeometry:100}},e.prototype.getMarker=function(){return this.marker},e.prototype.setMarker=function(e){return this.marker=e,this.marker.getOverlay().feature=this,this.initEvents(this.marker),this.marker},e.prototype.handleGeometryEvents=function(){var e=this;return komoo.event.addListener(this.geometry,"coordinates_changed",function(t){return e.updateIcon(),komoo.event.trigger(e,"coordinates_changed",t)})},e.prototype.getUrl=function(){var e;return this.properties.type==="OrganizationBranch"?e="view_organization":e="view_"+this.properties.type.toLowerCase(),dutils.urls.resolve(e,{id:this.properties.id}).replace("//","/")},e.prototype.isHighlighted=function(){return this.highlighted},e.prototype.highlight=function(){return this.setHighlight(!0)},e.prototype.setHighlight=function(e,t){t==null&&(t=!1);if(this.highlighted===e)return;this.highlighted=e,this.updateIcon();if(!t)return komoo.event.trigger(this,"highlight_changed",this.highlighted)},e.prototype.isNew=function(){return!this.getProperty("id")},e.prototype.getIconUrl=function(e){var t,n,r;return this.getProperty("image")?this.getProperty("image"):(e==null&&(e=this.map?this.map.getZoom():10),r=e>=this.featureType.minZoomIcon?"near":"far",n=this.isHighlighted()?"highlighted/":"",this.properties.categories&&this.properties.categories[0]&&this.properties.categories[0].name&&e>=this.featureType.minZoomIcon?t=this.properties.categories[0].name.toLowerCase()+(this.properties.categories.length>1?"-plus":""):t=this.properties.type.toLowerCase(),("/static/img/"+r+"/"+n+t+".png").replace(" ","-"))},e.prototype.updateIcon=function(e){return this.setIcon(this.getIconUrl(e))},e.prototype.getCategoriesIcons=function(){var e,t,n,r,i;r=this.properties.categories,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push("/static/img/need_categories/"+category.name.toLowerCase()+".png");return i},e.prototype.getProperties=function(){return this.properties},e.prototype.setProperties=function(e){this.properties=e},e.prototype.getProperty=function(e){return this.properties[e]},e.prototype.setProperty=function(e,t){return this.properties[e]=t},e.prototype.getType=function(){return this.getProperty("type")},e.prototype.getCategories=function(){var e;return(e=this.getProperty("categories"))!=null?e:[]},e.prototype.getGeometryGeoJson=function(){return this.geometry.getGeoJson()},e.prototype.getGeometryCollectionGeoJson=function(){return{type:"GeometryCollection",geometries:[this.getGeometryGeoJson()]}},e.prototype.getGeoJsonGeometry=function(){return this.getGeometryGeoJson()},e.prototype.getGeoJson=function(){return{type:"Feature",geometry:this.getGeometryGeoJson(),properties:this.getProperties()}},e.prototype.getGeoJsonFeature=function(){return this.getGeoJson()},e.prototype.setEditable=function(e){return this.editable=e,this.geometry.setEditable(this.editable)},e.prototype.showGeometry=function(){return this.geometry.setMap(this.map)},e.prototype.hideGeometry=function(){return this.geometry.setMap(null)},e.prototype.showMarker=function(){var e;return(e=this.marker)!=null?e.setMap(this.map):void 0},e.prototype.hideMarker=function(){var e;return(e=this.marker)!=null?e.setMap(this.map):void 0},e.prototype.getMap=function(){return this.map},e.prototype.setMap=function(e,t){var n,r;t==null&&(t={geometry:!1,point:!1,icon:!1}),this.oldMap=this.map,this.map=e;if(this.properties.alwaysVisible===!0||this.editable)t={geometry:!0,point:!1,icon:!1};n=this.map!=null?this.map.getZoom():0,(r=this.marker)!=null&&r.setMap(t.point||t.icon||this.featureType.minZoomPoint<=n&&n<=this.featureType.maxZoomPoint||this.featureType.minZoomIcon<=n&&n<=this.featureType.maxZoomIcon?this.map:null),this.geometry.setMap(t.geometry||n<=this.featureType.maxZoomGeometry&&n>=this.featureType.minZoomGeometry?this.map:null),this.updateIcon();if(this.oldMap===void 0)return this.handleMapEvents()},e.prototype.handleMapEvents=function(){var e=this;return this.map.subscribe("feature_highlight_changed",function(t,n){if(n===e)return;if(e.isHighlighted())return e.setHighlight(!1,!0)})},e.prototype.getBounds=function(){return this.geometry.getBounds()},e.prototype.removeFromMap=function(){var e;return(e=this.marker)!=null&&e.setMap(null),this.setMap(null)},e.prototype.setVisible=function(e){var t;return this.visible=e,(t=this.marker)!=null&&t.setVisible(this.visible),this.geometry.setVisible(this.visible)},e.prototype.getCenter=function(){return this.geometry.getCenter()},e.prototype.setOptions=function(e){return this.geometry.setOptions(e)},e.prototype.getIcon=function(){return this.geometry.getIcon()},e.prototype.setIcon=function(e){var t;return(t=this.marker)!=null&&t.setIcon(e),this.geometry.setIcon(e)},e.prototype.getBorderSize=function(){return this.featureType.border_size},e.prototype.getBorderSizeHover=function(){return this.featureType.borderSizeHover},e.prototype.getBorderColor=function(){return this.featureType.borderColor},e.prototype.getBorderOpacity=function(){return this.featureType.borderOpacity},e.prototype.getBackgroundColor=function(){return this.featureType.backgroundColor},e.prototype.getBackgroundOpacity=function(){return this.featureType.backgroundOpacity},e.prototype.getDefaultZIndex=function(){return this.featureType.zIndex},e}(),window.komoo.features={Feature:n,makeFeature:function(e,t){var n;return new komoo.features.Feature({geojson:e,featureType:t!=null?t[e!=null?(n=e.properties)!=null?n.type:void 0:void 0]:void 0})}},window.komoo.features});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp=Object.prototype.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__indexOf=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("map/maps",["googlemaps","underscore","map/core","map/collections","map/features","map/geometries"],function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p;return window.komoo==null&&(window.komoo={}),(p=window.komoo).event==null&&(p.event=e.event),f=function(n){function o(e){var t,n,i,s,u=this;this.options=e!=null?e:{},this.addFeature=__bind(this.addFeature,this),o.__super__.constructor.call(this),this.initialized=this.data.deferred(),this.element=(s=this.options.element)!=null?s:document.getElementById(this.options.elementId),this.el=this.element,this.features=r.makeFeatureCollectionPlus({map:this}),this.components={},this.addComponent("map/controls::Location"),i=this.initGoogleMap(this.options.googleMapOptions),t=this.initFeatureTypes(),n=this.handleEvents(),this.data.when(i,t,n).done(function(){return u.initialized.resolve()})}return __extends(o,n),o.prototype.featureTypesUrl="/map_info/feature_types/",o.prototype.googleMapDefaultOptions={zoom:12,center:new e.LatLng(-23.55,-46.65),disableDefaultUI:!1,streetViewControl:!0,scaleControl:!0,panControlOptions:{position:e.ControlPosition.RIGHT_TOP},zoomControlOptions:{position:e.ControlPosition.RIGHT_TOP},scaleControlOptions:{position:e.ControlPosition.RIGHT_BOTTOM,style:e.ScaleControlStyle.DEFAULT},mapTypeControlOptions:{mapTypeIds:[e.MapTypeId.ROADMAP,e.MapTypeId.HYBRID]},mapTypeId:e.MapTypeId.HYBRID},o.prototype.addControl=function(e,t){return this.googleMap.controls[e].push(t)},o.prototype.loadGeoJsonFromOptons=function(){var e=this;return this.data.when(this.initialized).done(function(){var t,n;if(e.options.geojson)return n=e.loadGeoJSON(e.options.geojson,e.options.zoom==null),t=n.getBounds(),t!=null&&e.fitBounds(t),n!=null&&n.setMap(e,{geometry:!0,icon:!0}),e.publish("set_zoom",e.options.zoom),e.publish("features_loaded_from_options",n)})},o.prototype.initGoogleMap=function(t){return t==null&&(t=this.googleMapDefaultOptions),this.googleMap=new e.Map(this.element,t),this.handleGoogleMapEvents(),$(this.element).trigger("initialized",this)},o.prototype.handleGoogleMapEvents=function(){var e,t=this;return e=["click","idle"],e.forEach(function(e){return komoo.event.addListener(t.googleMap,e,function(n){return t.publish(e,n)})})},o.prototype.initFeatureTypes=function(){var e,t,n=this;return e=this.data.deferred(),this.featureTypes==null&&(this.featureTypes={}),this.options.featureTypes!=null?((t=this.options.featureTypes)!=null&&t.forEach(function(e){return n.featureTypes[e.type]=e}),this.loadGeoJsonFromOptons(),e.resolve()):$.ajax({url:this.featureTypesUrl,dataType:"json",success:function(t){return t.forEach(function(e){return n.featureTypes[e.type]=e}),n.loadGeoJsonFromOptons(),e.resolve()}}),e.promise()},o.prototype.handleEvents=function(){var t=this;return this.subscribe("features_loaded",function(e){return komoo.event.trigger(t,"features_loaded",e)}),this.subscribe("close_clicked",function(){return komoo.event.trigger(t,"close_click")}),this.subscribe("drawing_started",function(e){return komoo.event.trigger(t,"drawing_started",e)}),this.subscribe("drawing_finished",function(e,n){komoo.event.trigger(t,"drawing_finished",e,n);if(n===!1)return t.revertFeature(e);if(e.getProperty("id")==null)return t.addFeature(e)}),this.subscribe("set_location",function(n){var r;return n=n.split(","),r=new e.LatLng(n[0],n[1]),t.googleMap.setCenter(r)}),this.subscribe("set_zoom",function(e){return t.setZoom(e)})},o.prototype.addComponent=function(e,n,r){var i=this;return n==null&&(n="generic"),r==null&&(r={}),this.data.when(this.initialized).done(function(){return t.isString(e)?e=i.start(e,"",r):e=i.start(e),i.data.when(e).done(function(){var e,t,r,s,o;o=[];for(r=0,s=arguments.length;r<s;r++)e=arguments[r],e.setMap(i),(t=i.components)[n]==null&&(t[n]=[]),i.components[n].push(e),o.push(typeof e.enable=="function"?e.enable():void 0);return o})})},o.prototype.enableComponents=function(e){var t,n=this;return(t=this.components[e])!=null?t.forEach(function(e){return typeof e.enable=="function"?e.enable():void 0}):void 0},o.prototype.disableComponents=function(e){var t,n=this;return(t=this.components[e])!=null?t.forEach(function(e){return typeof e.disable=="function"?e.disable():void 0}):void 0},o.prototype.getComponentsStatus=function(e){var t,n,r=this;return t=[],(n=this.components[e])!=null&&n.forEach(function(e){if(e.enabled===!0)return t.push("enabled")}),__indexOf.call(t,"enabled")>=0?"enabled":"disabled"},o.prototype.clear=function(){return this.features.removeAllFromMap(),this.features.clear()},o.prototype.refresh=function(){return e.event.trigger(this.googleMap,"resize")},o.prototype.saveLocation=function(e,t){return e==null&&(e=this.googleMap.getCenter()),t==null&&(t=this.getZoom()),this.publish("save_location",e,t)},o.prototype.goToSavedLocation=function(){return this.publish("goto_saved_location"),!0},o.prototype.goToUserLocation=function(){return this.publish("goto_user_location")},o.prototype.handleFeatureEvents=function(e){var t,n=this;return t=["mouseover","mouseout","mousemove","click","dblclick","rightclick","highlight_changed"],t.forEach(function(t){return komoo.event.addListener(e,t,function(r){return n.publish("feature_"+t,r,e)})})},o.prototype.goTo=function(e,t){return t==null&&(t=!0),this.publish("goto",e,t)},o.prototype.panTo=function(e,t){return t==null&&(t=!1),this.goTo(e,t)},o.prototype.makeFeature=function(e,t){var n;return t==null&&(t=!0),n=i.makeFeature(e,this.featureTypes),t&&this.addFeature(n),this.publish("feature_created",n),n},o.prototype.addFeature=function(e){return this.handleFeatureEvents(e),this.features.push(e)},o.prototype.revertFeature=function(e){if(e.getProperty("id")==null)return e.setMap(null)},o.prototype.getFeatures=function(){return this.features},o.prototype.getFeaturesByType=function(e,t,n){return this.features.getByType(e,t,n)},o.prototype.showFeaturesByType=function(e,t,n){var r;return(r=this.getFeaturesByType(e,t,n))!=null?r.show():void 0},o.prototype.hideFeaturesByType=function(e,t,n){var r;return(r=this.getFeaturesByType(e,t,n))!=null?r.hide():void 0},o.prototype.showFeatures=function(e){return e==null&&(e=this.features),e.show()},o.prototype.hideFeatures=function(e){return e==null&&(e=this.features),e.hide()},o.prototype.centerFeature=function(e,t){var n;return n=e instanceof i.Feature?e:this.features.getById(e,t),this.panTo(n!=null?n.getCenter():void 0,!1)},o.prototype.loadGeoJson=function(e,t,n){var i,s=this;return t==null&&(t=!1),n==null&&(n=!0),i=r.makeFeatureCollection({map:this}),this.data.when(this.initialized).done(function(){var r,o;return(e!=null?e.type:void 0)==null||!e.type==="FeatureCollection"?i:((r=e.features)!=null&&r.forEach(function(e){var t;return t=s.features.getById(e.properties.type,e.properties.id),t==null&&(t=s.makeFeature(e,n)),i.push(t)}),t&&((o=i.getAt(0))!=null?o.getBounds():void 0)&&s.googleMap.fitBounds(i.getAt(0).getBounds()),s.publish("features_loaded",i))}),i},o.prototype.loadGeoJSON=function(e,t,n){return this.loadGeoJson(e,t,n)},o.prototype.getGeoJson=function(e){var t;return e==null&&(e={}),e.newOnly==null&&(e.newOnly=!1),e.currentOnly==null&&(e.currentOnly=!1),e.geometryCollection==null&&(e.geometryCollection=!1),t=e.newOnly?this.newFeatures:e.currentOnly?r.makeFeatureCollection({map:this.map,features:[this.currentFeature]}):this.features,t.getGeoJson({geometryCollection:e.geometryCollection})},o.prototype.getGeoJSON=function(e){return this.getGeoJson(e)},o.prototype.drawNewFeature=function(e,t){var n;return n=this.makeFeature({type:"Feature",geometry:{type:e},properties:{name:"New "+t,type:t}}),this.publish("draw_feature",e,n)},o.prototype.editFeature=function(e,t){var n=this;return this.data.when(this.initialized).then(function(){return e==null&&(e=n.features.getAt(0)),t!=null&&e.getGeometryType()===s.types.EMPTY?(e.setGeometry(s.makeGeometry({geometry:{type:t}})),n.publish("draw_feature",t,e)):n.publish("edit_feature",e)})},o.prototype.setMode=function(e){return this.mode=e,this.publish("mode_changed",this.mode)},o.prototype.selectCenter=function(e,t){return this.selectPerimeter(e,t)},o.prototype.selectPerimeter=function(e,t){return this.publish("select_perimeter",e,t)},o.prototype.highlightFeature=function(){return this.centerFeature.apply(this,arguments),this.features.highlightFeature.apply(this.features,arguments)},o.prototype.getBounds=function(){return this.googleMap.getBounds()},o.prototype.setZoom=function(e){if(e!=null)return this.googleMap.setZoom(e)},o.prototype.getZoom=function(){return this.googleMap.getZoom()},o.prototype.fitBounds=function(e){return e==null&&(e=this.features.getBounds()),this.googleMap.fitBounds(e)},o}(n.Mediator),h=function(e){function t(e){t.__super__.constructor.call(this,e),this.addComponent("map/maptypes::CleanMapType","mapType"),this.addComponent("map/controls::DrawingManager","drawing"),this.addComponent("map/controls::SearchBox")}return __extends(t,e),t}(f),a=function(e){function t(e){t.__super__.constructor.call(this,e),this.addComponent("map/maptypes::CleanMapType"),this.addComponent("map/controls::SaveLocation"),this.addComponent("map/controls::StreetView"),this.addComponent("map/controls::DrawingManager"),this.addComponent("map/controls::DrawingControl"),this.addComponent("map/controls::GeometrySelector"),this.addComponent("map/controls::SupporterBox"),this.addComponent("map/controls::PerimeterSelector"),this.addComponent("map/controls::SearchBox")}return __extends(t,e),t}(f),l=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.googleMapDefaultOptions={zoom:12,center:new e.LatLng(-23.55,-46.65),disableDefaultUI:!0,streetViewControl:!1,scaleControl:!0,scaleControlOptions:{position:e.ControlPosition.RIGHT_BOTTOM,style:e.ScaleControlStyle.DEFAULT},mapTypeId:e.MapTypeId.HYBRID},n}(f),c=function(e){function t(e){t.__super__.constructor.call(this,e),this.addComponent("map/maptypes::CleanMapType","mapType"),this.addComponent("map/controls::AutosaveLocation"),this.addComponent("map/controls::StreetView"),this.addComponent("map/controls::Tooltip","tooltip"),this.addComponent("map/controls::InfoWindow","infoWindow"),this.addComponent("map/controls::SupporterBox"),this.addComponent("map/controls::LicenseBox"),this.addComponent("map/controls::SearchBox")}return __extends(t,e),t.prototype.loadGeoJson=function(e,n,r){var i,s=this;return n==null&&(n=!1),r==null&&(r=!0),i=t.__super__.loadGeoJson.call(this,e,n,r),i.forEach(function(e){return e.setMap(s,{geometry:!0})}),i},t}(f),u=function(e){function t(e){t.__super__.constructor.call(this,e),this.addComponent("map/providers::FeatureProvider","provider"),this.addComponent("map/controls::FeatureClusterer","clusterer",{featureType:"Community",map:this})}return __extends(t,e),t}(c),o=function(e){function t(e){var n;t.__super__.constructor.call(this,e),this.addComponent("map/controls::DrawingManager"),this.addComponent("map/controls::DrawingControl"),this.addComponent("map/controls::GeometrySelector"),this.addComponent("map/controls::PerimeterSelector"),console.log(e),(e!=null?(n=e.geojson)!=null?n.features:void 0:void 0)||this.goToSavedLocation()||this.goToUserLocation()}return __extends(t,e),t}(u),window.komoo.maps={Map:f,Preview:l,AjaxMap:u,makeMap:function(e){var t,n;e==null&&(e={}),t=(n=e.type)!=null?n:"map";if(t==="main")return new o(e);if(t==="editor")return new a(e);if(t==="view")return new u(e);if(t==="static")return new c(e);if(t==="preview"||t==="tooltip")return new l(e);if(t==="userEditor")return new h(e)}},window.komoo.maps}),define("map.jquery",["jquery","map/maps"],function(e,t){return function(e){var n,r,i,s;return r=function(e){var t;return t=e.data.map,n(t),i(t),t.refresh()},n=function(t,n){var r,i;return n==null&&(n=e("#map-panel")),r=e("body").innerHeight()-e("#top").innerHeight()-e(".upper_bar").innerHeight()-5,e(t.element).height(r),n.height(r),i=e(".panel-info-wrapper"),i&&(r-=i.height()+30),e(".panel",n).height(r-146)},i=function(t,n){var r,i;n==null&&(n=e("#map-panel")),i=n.innerWidth();try{r=n.position().left}catch(s){r=0}return e(t.element).css({marginLeft:i+r,width:"auto"})},s={init:function(n){return this.each(function(){var i,s,o,u,a,f;i=e(this),i.addClass("komoo-map-googlemap"),o=e.extend({element:i.get(0)},e.fn.komooMap.defaults,n),o.width!=null&&i.width(o.width),o.height!=null&&i.height(o.height);if((o!=null?o.type:void 0)==="preview"&&!(o!=null?(u=o.geojson)!=null?(a=u.features)!=null?(f=a[0])!=null?f.geometry:void 0:void 0:void 0:void 0)&&(o!=null?!o.force:!void 0)){i.html(e("<div>").addClass("placeholder").text("Informação geométrica não disponível")),i.parent().parent().find(".see-on-map").hide();return}s=t.makeMap(o),i.data("map",s),o.mapType!=null&&s.googleMap.setMapTypeId(o.mapType);if(o.height==="100%")return e(window).resize({map:s},r),e(window).resize()})},edit:function(t){var n;return(n=e(this).data("map"))!=null&&n.editFeature(t),e(this)},geojson:function(t){var n,r;return t==null?(n=e(this).data("map"))!=null?n.getGeoJson():void 0:(r=e(this).data("map"))!=null?r.loadGeoJson(t):void 0},goTo:function(t){var n,r;return(n=e(this).data("map"))!=null&&n.panTo((r=t.position)!=null?r:t.address,t.displayMarker),e(this)},highlight:function(t){var n;return(n=e(this).data("map"))!=null&&n.highlightFeature(t.type,t.id),e(this)},resize:function(){return e(window).resize()}},e.fn.komooMap=function(t){return s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):typeof t=="object"||!t?s.init.apply(this,arguments):e.error("Method "+t+" does not exist on jQuery.komooMap")},e.fn.komooMap.defaults={type:"editor"}}(e)}),define("project/model",["jquery","backbone"],function(e,t){var n,r;return n=t.Model.extend({urlRoot:"/projects/",addObject:function(t){var n,r=this;return n=e.Deferred(),e.post("/project/add_related/",{object_id:t.get("id"),content_type:t.get("content_type"),project_id:this.get("id")},"json").success(function(e){return e.success?n.resolve(r):n.reject(r,"Falha ao relacionar este objeto ao projeto selecionado")}).error(function(){return n.reject(r,"Falha no servidor")}),n.promise()}}),r=t.Collection.extend({model:n,parse:function(e){return e.results}}),{Project:n,Projects:r}}),define("text!templates/widgets/_autocomplete.html",[],function(){return'<input type="hidden"  name="<%= name %>" value="" id="id_<%= name %>" />\n<input type="text"  id="id_<%= name %>_autocomplete" value="" />\n'}),define("widgets/autocomplete",["jquery","underscore","backbone","text!templates/widgets/_autocomplete.html"],function(e,t,n,r){var i;return i=n.View.extend({className:"autocomplete",inputName:"autocomplete",autocompleteSource:"/autocomplete/",initialize:function(e,n){return this.inputName=e||this.inputName,this.autocompleteSource=n||this.autocompleteSource,this.template=t.template(r)},clear:function(){return this.$input.val(""),this.$value.val("")},val:function(){return console.log("value",this.$value.val()),this.$value.val()},render:function(){var e,t=this;return e=this.template({name:this.inputName}),this.$el.html(e),this.$input=this.$el.find("#id_"+this.inputName+"_autocomplete"),this.$value=this.$el.find("#id_"+this.inputName),this.$input.autocomplete({source:this.autocompleteSource,focus:function(e,n){return t.$input.val(n.item.label),!1},select:function(e,n){return t.$input.val(n.item.label),t.$value.val(n.item.value),!1},change:function(e,n){if(!n.item||!t.$input.val())return t.clear()}}),this}}),i}),define("text!templates/project/_add_dialog.html",[],function(){return'<!-- Modal form for adding this project to a project -->\n<div class="modal hide dialog" id="add-project-modal" style="display:none;">\n    <div class="modal-header">\n        <button type="button" id="add-project-close" class="close" data-dismiss="modal">×</button>\n        <div class="add-project-modal-header">\n          <%= gettext(\'Add this object to a project\') %>\n        </div>\n    </div>\n    <div class="modal-body">\n        <p>\n        <div class="project-selector"></div>\n        </p>\n        <div id="add-project-msg" class="msg add-project-msg">\n        </div>\n    </div>\n    <div class="modal-footer">\n        <a href="#" class="btn cancel" id="add-project-cancel" >\n          <%= gettext(\'Cancel\') %>\n        </a>\n        <a href="#" class="button disabled save" id="add-project-save">\n          <%= gettext(\'Save changes\') %>\n        </a>\n    </div>\n</div>\n'}),define("project/add_dialog",["jquery","underscore","backbone","project/model","widgets/autocomplete","text!templates/project/_add_dialog.html"],function(e,t,n,r,i,s){var o,u;return u=i.extend({inputName:"project",autocompleteSource:"/project/search_by_name",className:"project_autocomplete"}),o=n.View.extend({events:{"click .save":"onSaveBtnClick","click .cancel":"onCancelBtnClick"},initialize:function(){var e=this;return t.bindAll(this,"render"),this.template=t.template(s),this.autocomplete=(new u).render(),this.autocomplete.$input.on("autocompleteselect",function(t,n){return e.onProjectSelected(n.item)})},open:function(){return e("body").append(this.$el),this.$(".dialog").modal("show"),this},close:function(){return this.$(".dialog").modal("hide"),this},clear:function(){return this.autocomplete.clear(),this.$(".msg").html(""),this.$(".save").addClass("disabled"),this},onCancelBtnClick:function(){return this.close(),!1},onSaveBtnClick:function(){var e,t,n=this;return this.$(".save").hasClass("disabled")&&!1,t=this.autocomplete.val(),t&&(e=new r.Project({id:t}),e.fetch(),e.addObject(this.model).done(function(e){return n.trigger("saved",e)}).fail(function(e,t){return n.trigger("failed",e,t)})),!1},onProjectSelected:function(e){return this.$(".msg").html("<p>Este objeto será adicionado ao projeto <strong> "+e.label+" </strong></p>"),this.$(".save").removeClass("disabled")},render:function(){var e,t=this;return e=this.template(),this.$el.html(e),this.$(".project-selector").append(this.autocomplete.$el),this.$(".dialog").on("hide",function(){return t.clear()}),this}})}),define("text!templates/project/_box.html",[],function(){return'<header class="projects-tag-header">\n    <img src="/static/img/menu/project.png">\n    <span class="projects-tag-title"><%= gettext(\'Projects\') %></span>\n</header>\n<section>\n    <ul id="project-related-list" class=\'list\'>\n    </ul>\n    <div class="centralizer apart">\n        <a href="#" id="add-to-project" class="button add login-required"><%= gettext(\'Add to a project\') %></a>\n    </div>\n</section>\n'}),define("project/box",["jquery","underscore","backbone","project/add_dialog","text!templates/project/_box.html","utils"],function(e,t,n,r,i){var s,o;return o=n.View.extend({tagName:"li",initialize:function(){return t.bindAll(this,"render"),this.model.bind("change",this.render,this),this.model.bind("destroy",this.remove,this)},render:function(){return this.$el.html('<a href="'+this.model.get("view_url")+'">'+this.model.get("name")+"</a>"),this}}),s=n.View.extend({className:"project_box",events:{"click .add":"onAddBtnClick"},initialize:function(){var e,n,s=this;return t.bindAll(this,"render"),this.template=t.template(i),(e=this.collection)!=null&&e.bind("add",this.addOne,this),(n=this.collection)!=null&&n.bind("reset",this.render,this),this.addDialog=(new r({model:this.model})).render(),this.addDialog.on("saved",function(e){return flash("Adicionado ao projeto "+e.get("name")),s.collection.add(e),s.addDialog.close()}),this.addDialog.on("failed",function(e,t){return flash("Falhou ao adicionar ao projeto "+e.get("name")+": "+t)})},addOne:function(e){var t;return t=new o({model:e}),this.$(".list").append(t.render().el)},addAll:function(){var e,t=this;return(e=this.collection)!=null?e.each(function(e){return t.addOne(e)}):void 0},openAddDialog:function(){return this.addDialog.open()},onAddBtnClick:function(){return this.openAddDialog(),!1},render:function(){var e;return e=this.template({projects:this.collection}),this.$el.html(e),this.addAll(),this}}),s}),define("community/model",["backbone","project/model","utils"],function(e,t){var n,r;return r=e.Model.extend({urlRoot:"/community/",initialize:function(){return this.projects=nestCollection(this,"projects",new t.Projects(this.get("projects"))),this.projects.url=""+this.url()+"/projects/"}}),n=e.Collection.extend({model:r,parse:function(e){return e.results}}),{Community:r,Communities:n}})