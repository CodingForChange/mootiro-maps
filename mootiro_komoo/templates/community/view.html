{% extends "global.html" %}

{% load i18n %}
{% load komoo_tags %}
{% load moderation_tags %}
{% load comment_tags %}
{% load markitup_tags %}
{% load upload_tags %}
{% load project_tags %}

{% block title %}{{ community.name }}{% endblock %}

{% block menu %} {% menu "community" %} {% endblock %}

{% block content %}

<div id="main-content">
  <div class="main-column">
    <h2 class="title">{{ community.name }}</h2>
    <div class="view-edit-btn">
      {% history community %}
      <a href="{% url view_discussion community.perm_id %}" class="btn login-required"><i class="icon-comment"></i></a>
      <a href="{% url edit_community community.id %}" class="btn login-required"><i class="icon-pencil"></i></a>
    </div>

    <div class="clear-both"></div>

    <div class="mark-down">{{ community.description|render_markup|safe }}</div>
    <p>
      <!-- <span class="meta-info">Type</span>NOT IMPLEMENTED<br/> -->
      <span class="meta-info">{% trans "Population" %}</span> {% firstof community.population '-' %}
    </p>
    <div class="view-footer">
        {% image_gallery community %}
    </div>

  </div>

  <div class="right-bar">
    <div id="map-preview">
      <div id="map-preview-canvas"></div>
    </div>
    <a href="{% url community_on_map community.id %}">{% trans 'see on map' %}</a>

    {% taglist community %}

    <div class="block">
      <h3>{% trans "Nearby communities" %}</h3>
      <ul>
        {% for c in community.closest_communities %}
        <li><a href="{% url view_community c.id %}">{{ c.name }}</a></li>
        {% endfor %}
      </ul>
    </div>
    {#% projects_for_object community %#}
    <div id="projectsBox" class="block">
    </div>
  </div>

  <div class="view-extras">
    {% track_buttons community %}
    {% report_content community %}
    {% delete_button community %}
    {% social_buttons %}
    {% comments community %}
  </div>

</div>

{% endblock %}

{% block page_scripts %}
<script type="text/javascript">
  var KomooNS = (function (KomooNS) {

    KomooNS.current_object = {
      id: {{ community.id }},
      type: '{{ community.classname }}',
      appLabel: '{{ community.app_label }}',
      modelName: '{{ community.modelname }}',
      geojson: {{ community.geojson|safe }}
    };

    require(['jquery', 'map.jquery'], function ($) {
      $("#map-preview-canvas").komooMap({
        type: 'preview',
        geojson: KomooNS.current_object.geojson,
        width: '200px',
        height: '200px'
      });
    });

    return KomooNS;
  }(KomooNS || {}));

  </script>
  {% comments_staticfiles %}
{% endblock %}
